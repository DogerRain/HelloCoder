<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RocketMQ的入门 | HelloCoder</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/img/favicon.ico">
    <script charset="utf-8" async="async" src="/js/jquery.min.js"></script>
    <script charset="utf-8" async="async" src="/js/global.js"></script>
    <script charset="utf-8" async="async" src="/js/fingerprint2.min.js"></script>
    <script charset="utf-8" async="async" src="https://readmore.openwrite.cn/js/readmore.js"></script>
    <script charset="utf-8" async="async" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <script>
              var _hmt = _hmt || [];
              (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?b673363a2df767abd890cd6918642392";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
              })();
            </script>
    <meta name="description" content="java面试,java学习,面试指南,Java小白求职之路">
    <meta name="keywords" content="java面试,java面试题目,java核心知识,面试指南,Java小白求职之路">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.c9315ac1.css" as="style"><link rel="preload" href="/assets/js/app.f3da103e.js" as="script"><link rel="preload" href="/assets/js/3.d853b231.js" as="script"><link rel="preload" href="/assets/js/4.7c2b82a8.js" as="script"><link rel="preload" href="/assets/js/254.0c73dcd5.js" as="script"><link rel="prefetch" href="/assets/js/10.4ae439dd.js"><link rel="prefetch" href="/assets/js/100.173f8f20.js"><link rel="prefetch" href="/assets/js/101.4610fe76.js"><link rel="prefetch" href="/assets/js/102.e9a9fd92.js"><link rel="prefetch" href="/assets/js/103.aa1e1408.js"><link rel="prefetch" href="/assets/js/104.36350807.js"><link rel="prefetch" href="/assets/js/105.43045afe.js"><link rel="prefetch" href="/assets/js/106.c79c463c.js"><link rel="prefetch" href="/assets/js/107.a7a49d74.js"><link rel="prefetch" href="/assets/js/108.2bff889a.js"><link rel="prefetch" href="/assets/js/109.04023340.js"><link rel="prefetch" href="/assets/js/11.44922d1d.js"><link rel="prefetch" href="/assets/js/110.ac720fe0.js"><link rel="prefetch" href="/assets/js/111.4fc6ed56.js"><link rel="prefetch" href="/assets/js/112.d516d7bd.js"><link rel="prefetch" href="/assets/js/113.02d42d28.js"><link rel="prefetch" href="/assets/js/114.1d5e84d5.js"><link rel="prefetch" href="/assets/js/115.9e1b5a99.js"><link rel="prefetch" href="/assets/js/116.32e7b8ef.js"><link rel="prefetch" href="/assets/js/117.b0214827.js"><link rel="prefetch" href="/assets/js/118.fdf801a2.js"><link rel="prefetch" href="/assets/js/119.64b657c4.js"><link rel="prefetch" href="/assets/js/12.8d895fa1.js"><link rel="prefetch" href="/assets/js/120.706039f0.js"><link rel="prefetch" href="/assets/js/121.c61eb2d1.js"><link rel="prefetch" href="/assets/js/122.1ed6766a.js"><link rel="prefetch" href="/assets/js/123.776bec13.js"><link rel="prefetch" href="/assets/js/124.e898e173.js"><link rel="prefetch" href="/assets/js/125.926c5d9a.js"><link rel="prefetch" href="/assets/js/126.c40a2866.js"><link rel="prefetch" href="/assets/js/127.922c9dcb.js"><link rel="prefetch" href="/assets/js/128.9da53125.js"><link rel="prefetch" href="/assets/js/129.3b52fdf5.js"><link rel="prefetch" href="/assets/js/13.ecb06f05.js"><link rel="prefetch" href="/assets/js/130.abc38abb.js"><link rel="prefetch" href="/assets/js/131.0134b765.js"><link rel="prefetch" href="/assets/js/132.7c35fd2c.js"><link rel="prefetch" href="/assets/js/133.9d9310cd.js"><link rel="prefetch" href="/assets/js/134.1fbcd0af.js"><link rel="prefetch" href="/assets/js/135.a9ab5a38.js"><link rel="prefetch" href="/assets/js/136.a53f1086.js"><link rel="prefetch" href="/assets/js/137.cb18fbb0.js"><link rel="prefetch" href="/assets/js/138.61c9b905.js"><link rel="prefetch" href="/assets/js/139.eab9d4e4.js"><link rel="prefetch" href="/assets/js/14.ede8fe9f.js"><link rel="prefetch" href="/assets/js/140.4b639de0.js"><link rel="prefetch" href="/assets/js/141.263b9d06.js"><link rel="prefetch" href="/assets/js/142.3a918bf5.js"><link rel="prefetch" href="/assets/js/143.f6d44ad3.js"><link rel="prefetch" href="/assets/js/144.98de1fe9.js"><link rel="prefetch" href="/assets/js/145.4712fb35.js"><link rel="prefetch" href="/assets/js/146.14315f3c.js"><link rel="prefetch" href="/assets/js/147.b9e07237.js"><link rel="prefetch" href="/assets/js/148.864aff45.js"><link rel="prefetch" href="/assets/js/149.461bdfe6.js"><link rel="prefetch" href="/assets/js/15.c3230c54.js"><link rel="prefetch" href="/assets/js/150.6124f061.js"><link rel="prefetch" href="/assets/js/151.523716ec.js"><link rel="prefetch" href="/assets/js/152.43bbd110.js"><link rel="prefetch" href="/assets/js/153.6e8fcf12.js"><link rel="prefetch" href="/assets/js/154.908df775.js"><link rel="prefetch" href="/assets/js/155.3e58156b.js"><link rel="prefetch" href="/assets/js/156.7035f1a1.js"><link rel="prefetch" href="/assets/js/157.67cfb6c2.js"><link rel="prefetch" href="/assets/js/158.d0e549d7.js"><link rel="prefetch" href="/assets/js/159.5eadcfeb.js"><link rel="prefetch" href="/assets/js/16.325c0533.js"><link rel="prefetch" href="/assets/js/160.09b7b3fc.js"><link rel="prefetch" href="/assets/js/161.30854344.js"><link rel="prefetch" href="/assets/js/162.bfeffb35.js"><link rel="prefetch" href="/assets/js/163.6657fdd0.js"><link rel="prefetch" href="/assets/js/164.e3b392cd.js"><link rel="prefetch" href="/assets/js/165.ddbd7c8d.js"><link rel="prefetch" href="/assets/js/166.2388084f.js"><link rel="prefetch" href="/assets/js/167.4c8dd210.js"><link rel="prefetch" href="/assets/js/168.5af73044.js"><link rel="prefetch" href="/assets/js/169.cb6cdc2b.js"><link rel="prefetch" href="/assets/js/17.ff77b3fb.js"><link rel="prefetch" href="/assets/js/170.659b24ec.js"><link rel="prefetch" href="/assets/js/171.7e5c5134.js"><link rel="prefetch" href="/assets/js/172.944442cd.js"><link rel="prefetch" href="/assets/js/173.f8584deb.js"><link rel="prefetch" href="/assets/js/174.6e7474c2.js"><link rel="prefetch" href="/assets/js/175.4391b1a5.js"><link rel="prefetch" href="/assets/js/176.414e7d67.js"><link rel="prefetch" href="/assets/js/177.9ee342d6.js"><link rel="prefetch" href="/assets/js/178.218628b5.js"><link rel="prefetch" href="/assets/js/179.24026ab7.js"><link rel="prefetch" href="/assets/js/18.f4bf7b00.js"><link rel="prefetch" href="/assets/js/180.44e3f573.js"><link rel="prefetch" href="/assets/js/181.2fb9cc5d.js"><link rel="prefetch" href="/assets/js/182.46fe4f8f.js"><link rel="prefetch" href="/assets/js/183.8e2ff9c3.js"><link rel="prefetch" href="/assets/js/184.cab1305b.js"><link rel="prefetch" href="/assets/js/185.e8b21889.js"><link rel="prefetch" href="/assets/js/186.c6ed1f1c.js"><link rel="prefetch" href="/assets/js/187.024d7676.js"><link rel="prefetch" href="/assets/js/188.5a46c1e5.js"><link rel="prefetch" href="/assets/js/189.878925a2.js"><link rel="prefetch" href="/assets/js/19.560965c0.js"><link rel="prefetch" href="/assets/js/190.8a367b6c.js"><link rel="prefetch" href="/assets/js/191.104a9525.js"><link rel="prefetch" href="/assets/js/192.6f3dca65.js"><link rel="prefetch" href="/assets/js/193.72ed5a60.js"><link rel="prefetch" href="/assets/js/194.9ed31b5e.js"><link rel="prefetch" href="/assets/js/195.4b1c3be0.js"><link rel="prefetch" href="/assets/js/196.50a5eabf.js"><link rel="prefetch" href="/assets/js/197.aab7e410.js"><link rel="prefetch" href="/assets/js/198.f1f227a9.js"><link rel="prefetch" href="/assets/js/199.37f6e83f.js"><link rel="prefetch" href="/assets/js/20.3b4d3f33.js"><link rel="prefetch" href="/assets/js/200.f8763c46.js"><link rel="prefetch" href="/assets/js/201.45636f7c.js"><link rel="prefetch" href="/assets/js/202.77a8d14e.js"><link rel="prefetch" href="/assets/js/203.34a3fe1a.js"><link rel="prefetch" href="/assets/js/204.e5d92f87.js"><link rel="prefetch" href="/assets/js/205.580f67a9.js"><link rel="prefetch" href="/assets/js/206.27dfbbf8.js"><link rel="prefetch" href="/assets/js/207.ac565e26.js"><link rel="prefetch" href="/assets/js/208.0a3436b4.js"><link rel="prefetch" href="/assets/js/209.d96af0e6.js"><link rel="prefetch" href="/assets/js/21.060c6908.js"><link rel="prefetch" href="/assets/js/210.24ca5471.js"><link rel="prefetch" href="/assets/js/211.a2129f6b.js"><link rel="prefetch" href="/assets/js/212.e7334eb0.js"><link rel="prefetch" href="/assets/js/213.a982c751.js"><link rel="prefetch" href="/assets/js/214.103846ed.js"><link rel="prefetch" href="/assets/js/215.74918c49.js"><link rel="prefetch" href="/assets/js/216.60727bdc.js"><link rel="prefetch" href="/assets/js/217.fc2cb3d5.js"><link rel="prefetch" href="/assets/js/218.06ca5baf.js"><link rel="prefetch" href="/assets/js/219.dd370d33.js"><link rel="prefetch" href="/assets/js/22.c972fb1d.js"><link rel="prefetch" href="/assets/js/220.dee14023.js"><link rel="prefetch" href="/assets/js/221.1fdf2886.js"><link rel="prefetch" href="/assets/js/222.30f92362.js"><link rel="prefetch" href="/assets/js/223.b91776fb.js"><link rel="prefetch" href="/assets/js/224.fdc8185d.js"><link rel="prefetch" href="/assets/js/225.6fab5eb1.js"><link rel="prefetch" href="/assets/js/226.930ac4f9.js"><link rel="prefetch" href="/assets/js/227.3e2d8058.js"><link rel="prefetch" href="/assets/js/228.a336cfdc.js"><link rel="prefetch" href="/assets/js/229.397d17dd.js"><link rel="prefetch" href="/assets/js/23.83da36db.js"><link rel="prefetch" href="/assets/js/230.53060f83.js"><link rel="prefetch" href="/assets/js/231.36df3bc1.js"><link rel="prefetch" href="/assets/js/232.033a21e0.js"><link rel="prefetch" href="/assets/js/233.6a535523.js"><link rel="prefetch" href="/assets/js/234.31ea6442.js"><link rel="prefetch" href="/assets/js/235.2d6cdc3f.js"><link rel="prefetch" href="/assets/js/236.2c8947ae.js"><link rel="prefetch" href="/assets/js/237.1728d98c.js"><link rel="prefetch" href="/assets/js/238.d865a7ca.js"><link rel="prefetch" href="/assets/js/239.765558bf.js"><link rel="prefetch" href="/assets/js/24.cecccfd0.js"><link rel="prefetch" href="/assets/js/240.32e610da.js"><link rel="prefetch" href="/assets/js/241.65b86c5b.js"><link rel="prefetch" href="/assets/js/242.af39cf40.js"><link rel="prefetch" href="/assets/js/243.454c0b6d.js"><link rel="prefetch" href="/assets/js/244.7d048db1.js"><link rel="prefetch" href="/assets/js/245.a2725913.js"><link rel="prefetch" href="/assets/js/246.b4249795.js"><link rel="prefetch" href="/assets/js/247.20d549c1.js"><link rel="prefetch" href="/assets/js/248.2f94a4c3.js"><link rel="prefetch" href="/assets/js/249.9d0b7619.js"><link rel="prefetch" href="/assets/js/25.9626fb19.js"><link rel="prefetch" href="/assets/js/250.238a1611.js"><link rel="prefetch" href="/assets/js/251.0fd27b0f.js"><link rel="prefetch" href="/assets/js/252.3661dbfb.js"><link rel="prefetch" href="/assets/js/253.5bb27f97.js"><link rel="prefetch" href="/assets/js/255.7a90d174.js"><link rel="prefetch" href="/assets/js/256.2e26932a.js"><link rel="prefetch" href="/assets/js/257.a0a640aa.js"><link rel="prefetch" href="/assets/js/258.a57cc906.js"><link rel="prefetch" href="/assets/js/259.c1151fbc.js"><link rel="prefetch" href="/assets/js/26.daa65600.js"><link rel="prefetch" href="/assets/js/260.575ec3b1.js"><link rel="prefetch" href="/assets/js/261.220bf2ff.js"><link rel="prefetch" href="/assets/js/262.6b39b557.js"><link rel="prefetch" href="/assets/js/263.97a40b27.js"><link rel="prefetch" href="/assets/js/264.6c9300d4.js"><link rel="prefetch" href="/assets/js/265.209b0add.js"><link rel="prefetch" href="/assets/js/266.d9291f2f.js"><link rel="prefetch" href="/assets/js/267.19969bab.js"><link rel="prefetch" href="/assets/js/268.fe38aee3.js"><link rel="prefetch" href="/assets/js/269.204c89bd.js"><link rel="prefetch" href="/assets/js/27.348cc83e.js"><link rel="prefetch" href="/assets/js/270.95fc4c90.js"><link rel="prefetch" href="/assets/js/271.d6702546.js"><link rel="prefetch" href="/assets/js/272.f9aa38d4.js"><link rel="prefetch" href="/assets/js/273.70f79346.js"><link rel="prefetch" href="/assets/js/274.34026ec9.js"><link rel="prefetch" href="/assets/js/275.935e007e.js"><link rel="prefetch" href="/assets/js/276.f16ff4a9.js"><link rel="prefetch" href="/assets/js/277.1640a42e.js"><link rel="prefetch" href="/assets/js/278.4d317bd5.js"><link rel="prefetch" href="/assets/js/279.004395b0.js"><link rel="prefetch" href="/assets/js/28.5c4aa00d.js"><link rel="prefetch" href="/assets/js/280.08c02df7.js"><link rel="prefetch" href="/assets/js/281.019fac96.js"><link rel="prefetch" href="/assets/js/282.cb9e1b5d.js"><link rel="prefetch" href="/assets/js/283.63c174ce.js"><link rel="prefetch" href="/assets/js/284.00b1bbe5.js"><link rel="prefetch" href="/assets/js/285.ac573a59.js"><link rel="prefetch" href="/assets/js/286.2de5eb40.js"><link rel="prefetch" href="/assets/js/287.14d929bb.js"><link rel="prefetch" href="/assets/js/288.7d623fc7.js"><link rel="prefetch" href="/assets/js/289.90f2a5e8.js"><link rel="prefetch" href="/assets/js/29.d29d322a.js"><link rel="prefetch" href="/assets/js/290.76ad2aff.js"><link rel="prefetch" href="/assets/js/291.9100f6e8.js"><link rel="prefetch" href="/assets/js/292.1d6470ce.js"><link rel="prefetch" href="/assets/js/293.0619e735.js"><link rel="prefetch" href="/assets/js/294.e3e7ff50.js"><link rel="prefetch" href="/assets/js/295.3b7009f1.js"><link rel="prefetch" href="/assets/js/296.f10235b7.js"><link rel="prefetch" href="/assets/js/297.cec03c6e.js"><link rel="prefetch" href="/assets/js/298.5f057bf9.js"><link rel="prefetch" href="/assets/js/299.25cec227.js"><link rel="prefetch" href="/assets/js/30.c54b4937.js"><link rel="prefetch" href="/assets/js/300.0a79feaa.js"><link rel="prefetch" href="/assets/js/301.f5d6831e.js"><link rel="prefetch" href="/assets/js/302.093b2582.js"><link rel="prefetch" href="/assets/js/303.94e1b518.js"><link rel="prefetch" href="/assets/js/304.63824518.js"><link rel="prefetch" href="/assets/js/305.eccc3626.js"><link rel="prefetch" href="/assets/js/306.27e1c8f7.js"><link rel="prefetch" href="/assets/js/307.dba7cfb8.js"><link rel="prefetch" href="/assets/js/308.027689b8.js"><link rel="prefetch" href="/assets/js/309.5383a75e.js"><link rel="prefetch" href="/assets/js/31.901df617.js"><link rel="prefetch" href="/assets/js/310.f676b4f6.js"><link rel="prefetch" href="/assets/js/311.e7224b12.js"><link rel="prefetch" href="/assets/js/312.17e65026.js"><link rel="prefetch" href="/assets/js/313.968cb11a.js"><link rel="prefetch" href="/assets/js/314.d7797a7c.js"><link rel="prefetch" href="/assets/js/315.bb5e619b.js"><link rel="prefetch" href="/assets/js/316.2ee556ca.js"><link rel="prefetch" href="/assets/js/317.962bcace.js"><link rel="prefetch" href="/assets/js/318.6b2d67a4.js"><link rel="prefetch" href="/assets/js/319.679dddc9.js"><link rel="prefetch" href="/assets/js/32.efd8fd23.js"><link rel="prefetch" href="/assets/js/320.d67dd3d0.js"><link rel="prefetch" href="/assets/js/321.9d9daa06.js"><link rel="prefetch" href="/assets/js/322.f5eeb09f.js"><link rel="prefetch" href="/assets/js/323.ddcc27dc.js"><link rel="prefetch" href="/assets/js/324.2322a0b4.js"><link rel="prefetch" href="/assets/js/325.6b3f178b.js"><link rel="prefetch" href="/assets/js/326.6f34763f.js"><link rel="prefetch" href="/assets/js/327.9e50bae1.js"><link rel="prefetch" href="/assets/js/328.973f9d3f.js"><link rel="prefetch" href="/assets/js/329.a98dd137.js"><link rel="prefetch" href="/assets/js/33.823c6d8b.js"><link rel="prefetch" href="/assets/js/330.318bbe31.js"><link rel="prefetch" href="/assets/js/331.45affe1c.js"><link rel="prefetch" href="/assets/js/332.37232b3e.js"><link rel="prefetch" href="/assets/js/333.97757b22.js"><link rel="prefetch" href="/assets/js/334.612d2181.js"><link rel="prefetch" href="/assets/js/335.8c7e1901.js"><link rel="prefetch" href="/assets/js/336.ca1f3ed6.js"><link rel="prefetch" href="/assets/js/337.af6296d7.js"><link rel="prefetch" href="/assets/js/338.6d272899.js"><link rel="prefetch" href="/assets/js/339.fae6142b.js"><link rel="prefetch" href="/assets/js/34.fc27c2f6.js"><link rel="prefetch" href="/assets/js/340.99ac2f20.js"><link rel="prefetch" href="/assets/js/341.c0da9051.js"><link rel="prefetch" href="/assets/js/342.f14dcd86.js"><link rel="prefetch" href="/assets/js/343.7e3fea91.js"><link rel="prefetch" href="/assets/js/344.0a7f96b8.js"><link rel="prefetch" href="/assets/js/345.f58844c6.js"><link rel="prefetch" href="/assets/js/346.b387c66a.js"><link rel="prefetch" href="/assets/js/347.a2a27ec5.js"><link rel="prefetch" href="/assets/js/348.cf431697.js"><link rel="prefetch" href="/assets/js/349.282bde8d.js"><link rel="prefetch" href="/assets/js/35.b2ef221a.js"><link rel="prefetch" href="/assets/js/350.9731ca40.js"><link rel="prefetch" href="/assets/js/351.d436ad1f.js"><link rel="prefetch" href="/assets/js/352.402baf6c.js"><link rel="prefetch" href="/assets/js/353.74a381f8.js"><link rel="prefetch" href="/assets/js/354.45d7d992.js"><link rel="prefetch" href="/assets/js/355.e8e1e161.js"><link rel="prefetch" href="/assets/js/356.5f97e7d5.js"><link rel="prefetch" href="/assets/js/357.e75fad61.js"><link rel="prefetch" href="/assets/js/358.bef10dde.js"><link rel="prefetch" href="/assets/js/359.02e106e3.js"><link rel="prefetch" href="/assets/js/36.cfb8061a.js"><link rel="prefetch" href="/assets/js/360.961f9022.js"><link rel="prefetch" href="/assets/js/361.36437530.js"><link rel="prefetch" href="/assets/js/37.dba60720.js"><link rel="prefetch" href="/assets/js/38.9b6de1f2.js"><link rel="prefetch" href="/assets/js/39.8f16c841.js"><link rel="prefetch" href="/assets/js/40.3c44a330.js"><link rel="prefetch" href="/assets/js/41.4d0861a2.js"><link rel="prefetch" href="/assets/js/42.082d9eb1.js"><link rel="prefetch" href="/assets/js/43.8e54dc04.js"><link rel="prefetch" href="/assets/js/44.e2f369fa.js"><link rel="prefetch" href="/assets/js/45.1c044bf1.js"><link rel="prefetch" href="/assets/js/46.fafa9edc.js"><link rel="prefetch" href="/assets/js/47.07b5866b.js"><link rel="prefetch" href="/assets/js/48.755b40a7.js"><link rel="prefetch" href="/assets/js/49.41128d76.js"><link rel="prefetch" href="/assets/js/5.115df96d.js"><link rel="prefetch" href="/assets/js/50.a3a9a79c.js"><link rel="prefetch" href="/assets/js/51.64a01322.js"><link rel="prefetch" href="/assets/js/52.657c8981.js"><link rel="prefetch" href="/assets/js/53.ae7bf626.js"><link rel="prefetch" href="/assets/js/54.f438756f.js"><link rel="prefetch" href="/assets/js/55.486e314e.js"><link rel="prefetch" href="/assets/js/56.da478f5e.js"><link rel="prefetch" href="/assets/js/57.67a5a81d.js"><link rel="prefetch" href="/assets/js/58.acac769a.js"><link rel="prefetch" href="/assets/js/59.9436e6fb.js"><link rel="prefetch" href="/assets/js/6.944b9deb.js"><link rel="prefetch" href="/assets/js/60.5f7e6ebb.js"><link rel="prefetch" href="/assets/js/61.3da7741b.js"><link rel="prefetch" href="/assets/js/62.bc65ff37.js"><link rel="prefetch" href="/assets/js/63.aaf4395c.js"><link rel="prefetch" href="/assets/js/64.2d928e2e.js"><link rel="prefetch" href="/assets/js/65.f8794b5d.js"><link rel="prefetch" href="/assets/js/66.a6f98efb.js"><link rel="prefetch" href="/assets/js/67.12595217.js"><link rel="prefetch" href="/assets/js/68.9205eb8c.js"><link rel="prefetch" href="/assets/js/69.d4089a83.js"><link rel="prefetch" href="/assets/js/7.309472d6.js"><link rel="prefetch" href="/assets/js/70.c7dd200e.js"><link rel="prefetch" href="/assets/js/71.0022bf58.js"><link rel="prefetch" href="/assets/js/72.4193223b.js"><link rel="prefetch" href="/assets/js/73.9daa5519.js"><link rel="prefetch" href="/assets/js/74.f779c2ca.js"><link rel="prefetch" href="/assets/js/75.910904a3.js"><link rel="prefetch" href="/assets/js/76.517f8127.js"><link rel="prefetch" href="/assets/js/77.96ed89b9.js"><link rel="prefetch" href="/assets/js/78.7c5f3b80.js"><link rel="prefetch" href="/assets/js/79.183857e2.js"><link rel="prefetch" href="/assets/js/8.0fbe85d0.js"><link rel="prefetch" href="/assets/js/80.fd827983.js"><link rel="prefetch" href="/assets/js/81.e3ea23b2.js"><link rel="prefetch" href="/assets/js/82.6d8e167a.js"><link rel="prefetch" href="/assets/js/83.fec5f014.js"><link rel="prefetch" href="/assets/js/84.30e7175b.js"><link rel="prefetch" href="/assets/js/85.824c6026.js"><link rel="prefetch" href="/assets/js/86.cb712026.js"><link rel="prefetch" href="/assets/js/87.a8e6bff2.js"><link rel="prefetch" href="/assets/js/88.45eb3d9c.js"><link rel="prefetch" href="/assets/js/89.a602a275.js"><link rel="prefetch" href="/assets/js/9.3fd05028.js"><link rel="prefetch" href="/assets/js/90.b2a32428.js"><link rel="prefetch" href="/assets/js/91.06318e59.js"><link rel="prefetch" href="/assets/js/92.b2cfbb6a.js"><link rel="prefetch" href="/assets/js/93.91ae5969.js"><link rel="prefetch" href="/assets/js/94.8182b13f.js"><link rel="prefetch" href="/assets/js/95.336c5196.js"><link rel="prefetch" href="/assets/js/96.e8ae48e4.js"><link rel="prefetch" href="/assets/js/97.44aa4149.js"><link rel="prefetch" href="/assets/js/98.cf278f3a.js"><link rel="prefetch" href="/assets/js/99.0c3e04fe.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.78c39f82.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c9315ac1.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/site/logo.png" alt="HelloCoder" class="logo"> <span class="site-name can-hide">HelloCoder</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/LearnJavaToFindAJob_README/" class="nav-link">《Java小白求职之路》</a></div><div class="nav-item"><a href="/pages/PureJavaCoderRoad_README/" class="nav-link">《小白学Java》</a></div><div class="nav-item"><a href="/pages/%E5%A6%82%E4%BD%95%E9%80%89%E9%A2%98/" class="nav-link">计算机毕设</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机资源" class="dropdown-title"><!----> <span class="title" style="display:;">计算机资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/awesome-programming-resources/" class="nav-link">一些免费计算机资源</a></li><li class="dropdown-item"><!----> <a href="/pages/Java%E5%B8%B8%E7%94%A8%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" class="nav-link">脚手架工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专栏系列" class="dropdown-title"><!----> <span class="title" style="display:;">专栏系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/%EF%BC%88%E4%B8%80%EF%BC%89%E7%BA%BF%E7%A8%8B%E6%98%AF%E4%BB%80%E4%B9%88/" class="nav-link">《从0到1学习Java多线程》</a></li><li class="dropdown-item"><!----> <a href="/pages/%EF%BC%881%EF%BC%89%E9%80%89%E6%8B%A9%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="nav-link">《从0到1搭建服务器》</a></li></ul></div></div><div class="nav-item"><a href="/pages/Java%E4%B9%A6%E6%9C%AC%E6%8E%A8%E8%8D%90/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/pages/%E5%85%B3%E4%BA%8E%E6%88%91/" class="nav-link">关于作者</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/LearnJavaToFindAJob_README/" class="nav-link">《Java小白求职之路》</a></div><div class="nav-item"><a href="/pages/PureJavaCoderRoad_README/" class="nav-link">《小白学Java》</a></div><div class="nav-item"><a href="/pages/%E5%A6%82%E4%BD%95%E9%80%89%E9%A2%98/" class="nav-link">计算机毕设</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机资源" class="dropdown-title"><!----> <span class="title" style="display:;">计算机资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/awesome-programming-resources/" class="nav-link">一些免费计算机资源</a></li><li class="dropdown-item"><!----> <a href="/pages/Java%E5%B8%B8%E7%94%A8%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" class="nav-link">脚手架工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专栏系列" class="dropdown-title"><!----> <span class="title" style="display:;">专栏系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/%EF%BC%88%E4%B8%80%EF%BC%89%E7%BA%BF%E7%A8%8B%E6%98%AF%E4%BB%80%E4%B9%88/" class="nav-link">《从0到1学习Java多线程》</a></li><li class="dropdown-item"><!----> <a href="/pages/%EF%BC%881%EF%BC%89%E9%80%89%E6%8B%A9%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="nav-link">《从0到1搭建服务器》</a></li></ul></div></div><div class="nav-item"><a href="/pages/Java%E4%B9%A6%E6%9C%AC%E6%8E%A8%E8%8D%90/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/pages/%E5%85%B3%E4%BA%8E%E6%88%91/" class="nav-link">关于作者</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>《PureJavaCoderRoad》</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>导读</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Java基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Java进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Java高阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>开发辅助工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>JavaEE</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>中间件</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading open"><span>MQ</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/Kafka%E7%9A%84%E5%85%A5%E9%97%A8/" class="sidebar-link">Kafka的入门</a></li><li><a href="/pages/RocketMQ%E7%9A%84%E5%85%A5%E9%97%A8/" aria-current="page" class="active sidebar-link">RocketMQ的入门</a></li><li><a href="/pages/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E5%85%A5%E9%97%A8/" class="sidebar-link">消息队列入门</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>架构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>建议</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0d043077><div class="articleInfo" data-v-0d043077><ul class="breadcrumbs" data-v-0d043077><li data-v-0d043077><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-0d043077></a></li> <li data-v-0d043077><a href="/categories/?category=PureJavaCoderRoad" title="分类" data-v-0d043077>PureJavaCoderRoad</a></li><li data-v-0d043077><a href="/categories/?category=%E4%B8%AD%E9%97%B4%E4%BB%B6" title="分类" data-v-0d043077>中间件</a></li><li data-v-0d043077><a href="/categories/?category=MQ" title="分类" data-v-0d043077>MQ</a></li></ul> <div class="info" data-v-0d043077><div title="标签" class="iconfont icon-biaoqian tags" data-v-0d043077><a href="/tags/?tag=RocketMQ" target="_blank" title="标签" class="beLink" data-v-0d043077>

          #RocketMQ

        </a><a href="/tags/?tag=%E5%85%A5%E9%97%A8" target="_blank" title="标签" class="beLink" data-v-0d043077>

          #入门

        </a></div> <div title="作者" class="author iconfont icon-touxiang" data-v-0d043077><a href="/pages/%E5%85%B3%E4%BA%8E%E6%88%91/" target="_blank" title="作者" class="beLink" data-v-0d043077>码农阿雨</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-0d043077><a href="javascript:;" data-v-0d043077>2022-05-26</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div id="right-menu-content" class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">RocketMQ的入门<!----></h1>  <div class="theme-vdoing-content content__default"><p><a href="https://rain.baimuxym.cn/article/49" target="_blank" rel="noopener noreferrer">RocketMQ的介绍<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.cnblogs.com/qdhxhz/p/11094624.html" target="_blank" rel="noopener noreferrer">RocketMQ(1)-架构原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.cnblogs.com/xuwc/p/9034352.html" target="_blank" rel="noopener noreferrer">rocketmq-常见问题总结(消息的顺序、重复、消费模式)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>本文是通过以下学习而总结的</p> <p>《RocketMQ从入门到实践》——丁威</p> <p>《Apache RocketMQ源码解析》——丁威</p> <p>B站</p></blockquote> <h1 id="_1、rocketmq是什么"><a href="#_1、rocketmq是什么" class="header-anchor">#</a> 1、RocketMQ是什么</h1> <p>RcoketMQ 是一款低延迟、高可靠、可伸缩、易于使用的<strong>消息中间件</strong>。</p> <p>什么是中间件，可以参考： <a href="/02.PureJavaCoderRoad/08.中间件/MQ/消息队列入门.html">消息队列入门.md</a></p> <h1 id="_2、rocketmq的组成"><a href="#_2、rocketmq的组成" class="header-anchor">#</a> 2、RocketMQ的组成</h1> <blockquote><p>RocketMQ官方文档：https://github.com/apache/rocketmq/blob/master/docs/cn/README.md</p></blockquote> <p>RocketMQ主要由 Producer、Broker、Consumer 三部分组成，其中Producer 负责生产消息，Consumer 负责消费消息，Broker 负责存储消息。</p> <p><img src="https://cdn.jsdelivr.net/gh/DogerRain/image@main/img-202109/image-20211012091010457.png" alt=""></p> <h3 id="_1、client"><a href="#_1、client" class="header-anchor">#</a> 1、Client</h3> <p>消息客户端，包括 Producer(消息发送者)和 Consumer(消费消费者)．</p> <h4 id="producer"><a href="#producer" class="header-anchor">#</a> Producer</h4> <p>消息发布的角色，支持分布式集群方式部署。Producer通过MQ的负载均衡模块选择相应的Broker集群队列进行消息投递，投递的过程支持快速失败并且低延迟。</p> <h4 id="consumer"><a href="#consumer" class="header-anchor">#</a> Consumer</h4> <p>消息消费的角色，支持分布式集群方式部署。支持以push推，pull拉两种模式对消息进行消费。同时也支持<strong>集群方式</strong>和<strong>广播方式</strong>的消费，它提供实时消息订阅机制，可以满足大多数用户的需求。</p> <p>客户端在同一 时间只会连接一台 nameserver，只有在连接出现异常时才会向尝试连接另外一台。客户端每隔 30s 向 Nameserver 发起 topic 的路由信息查询。</p> <h3 id="_2、nameserver"><a href="#_2、nameserver" class="header-anchor">#</a> 2、Nameserver</h3> <p>topic 的路由注册中心（类似于zookeeper），为客户端根据 Topic 提供路由服务，从而引导客户端向 Broker （支持Broker的动态注册与发现）发送消息。Nameserver 之间的节点不通信。路由信息在 Nameserver 集群中数据一致性采取的最终一致性。 主要有两个功能：</p> <ul><li>Broker管理，NameServer接受Broker集群的注册信息并且保存下来作为路由信息的基本数据。然后提供心跳检测机制，检查Broker是否还存活</li> <li>路由信息管理，每个NameServer将保存关于Broker集群的整个路由信息和用于客户端查询的队列信息。然后Producer和Conumser通过NameServer就可以知道整个Broker集群的路由信息，从而进行消息的投递和消费</li></ul> <p>NameServer通常也是集群的方式部署，<strong>各实例间相互不进行信息通讯</strong>。**Broker是向每一台NameServer注册自己的路由信息，所以每一个NameServer实例上面都保存一份完整的路由信息。**当某个NameServer因某种原因下线了，Broker仍然可以向其它NameServer同步其路由信息，Producer,Consumer仍然可以动态感知Broker的路由的信息。</p> <h3 id="_3、broker"><a href="#_3、broker" class="header-anchor">#</a> 3、Broker</h3> <p>消息存储服务器，Broker主要负责消息的存储、投递和查询以及服务高可用保证，分为两种角色：Master 与 Slave，上图中呈现的就是 2 主 2 从的部署架构。</p> <p>在 RocketMQ 中，主服务承担读写操作，从服务器作为一个备份，当主服务器存在压力时，从服务器可以承担读服务（消息消费）。所有 Broker，包含 Slave 服务器每隔 30s 会向 Nameserver 发送心跳包，心跳包中会包含存在在 Broker 上所有的 topic 的路由信息。</p> <p>结合部署架构图，描述集群工作流程：</p> <ul><li>启动NameServer，NameServer起来后监听端口，等待Broker、Producer、Consumer连上来，相当于一个路由控制中心。</li> <li>Broker启动，跟所有的NameServer保持长连接，定时发送心跳包。心跳包中包含当前Broker信息(IP+端口等)以及存储所有Topic信息。注册成功后，NameServer集群中就有Topic跟Broker的映射关系。</li> <li>收发消息前，先创建Topic，创建Topic时需要指定该Topic要存储在哪些Broker上，也可以在发送消息时自动创建Topic。</li> <li>Producer发送消息，启动时先跟NameServer集群中的其中一台建立长连接，并从NameServer中获取当前发送的Topic存在哪些Broker上，轮询从队列列表中选择一个队列，然后与队列所在的Broker建立长连接从而向Broker发消息。</li> <li>Consumer跟Producer类似，跟其中一台NameServer建立长连接，获取当前订阅Topic存在哪些Broker上，然后直接跟Broker建立连接通道，开始消费消息。</li></ul> <p>借用一张图：</p> <p><img src="F:%5C%E7%AC%94%E8%AE%B0%5CPureJavaCoderRoad%EF%BC%88Java%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%89%5Cdocs%5Carticles%5CMQ%5Cpicture%5Cimage-20210930103755270.png" alt=""></p> <p>RocketMQ消息丢失问题：</p> <ul><li>https://blog.csdn.net/u014634309/article/details/105086687</li> <li>https://blog.csdn.net/leeasony/article/details/104857576</li></ul> <h1 id="_3、基本概念"><a href="#_3、基本概念" class="header-anchor">#</a> 3、基本概念</h1> <p>在熟悉RocketMQ前，我在RocketMQ的官方网站直接复制以下概念过来，便于理解：</p> <hr> <h2 id="_1-消息模型-message-model"><a href="#_1-消息模型-message-model" class="header-anchor">#</a> 1 消息模型（Message Model）</h2> <p>RocketMQ主要由 Producer、Broker、Consumer 三部分组成，其中Producer 负责生产消息，Consumer 负责消费消息，Broker 负责存储消息。Broker 在实际部署过程中对应一台服务器，每个 Broker 可以存储多个Topic的消息，每个Topic的消息也可以分片存储于不同的 Broker。Message Queue 用于存储消息的物理地址，每个Topic中的消息地址存储于多个 Message Queue 中。ConsumerGroup 由多个Consumer 实例构成。</p> <h2 id="_2-消息生产者-producer"><a href="#_2-消息生产者-producer" class="header-anchor">#</a> 2 消息生产者（Producer）</h2> <p>负责生产消息，一般由业务系统负责生产消息。一个消息生产者会把业务应用系统里产生的消息发送到broker服务器。RocketMQ提供多种发送方式，同步发送、异步发送、顺序发送、单向发送。同步和异步方式均需要Broker返回确认信息，单向发送不需要。</p> <h2 id="_3-消息消费者-consumer"><a href="#_3-消息消费者-consumer" class="header-anchor">#</a> 3 消息消费者（Consumer）</h2> <p>负责消费消息，一般是后台系统负责异步消费。一个消息消费者会从Broker服务器拉取消息、并将其提供给应用程序。从用户应用的角度而言提供了两种消费形式：拉取式消费、推动式消费。</p> <h2 id="_4-主题-topic"><a href="#_4-主题-topic" class="header-anchor">#</a> 4 主题（Topic）</h2> <p>表示一类消息的集合，每个主题包含若干条消息，每条消息只能属于一个主题，是RocketMQ进行消息订阅的基本单位。</p> <h2 id="_5-代理服务器-broker-server"><a href="#_5-代理服务器-broker-server" class="header-anchor">#</a> 5 代理服务器（Broker Server）</h2> <p>消息中转角色，负责存储消息、转发消息。代理服务器在RocketMQ系统中负责接收从生产者发送来的消息并存储、同时为消费者的拉取请求作准备。代理服务器也存储消息相关的元数据，包括消费者组、消费进度偏移和主题和队列消息等。</p> <h2 id="_6-名字服务-name-server"><a href="#_6-名字服务-name-server" class="header-anchor">#</a> 6 名字服务（Name Server）</h2> <p>名称服务充当路由消息的提供者。生产者或消费者能够通过名字服务查找各主题相应的Broker IP列表。多个Namesrv实例组成集群，但相互独立，没有信息交换。</p> <h2 id="_7-拉取式消费-pull-consumer"><a href="#_7-拉取式消费-pull-consumer" class="header-anchor">#</a> 7 拉取式消费（Pull Consumer）</h2> <p>Consumer消费的一种类型，应用通常主动调用Consumer的拉消息方法从Broker服务器拉消息、主动权由应用控制。一旦获取了批量消息，应用就会启动消费过程。</p> <h2 id="_8-推动式消费-push-consumer"><a href="#_8-推动式消费-push-consumer" class="header-anchor">#</a> 8 推动式消费（Push Consumer）</h2> <p>Consumer消费的一种类型，该模式下Broker收到数据后会主动推送给消费端，该消费模式一般实时性较高。</p> <h2 id="_9-生产者组-producer-group"><a href="#_9-生产者组-producer-group" class="header-anchor">#</a> 9 生产者组（Producer Group）</h2> <p>同一类Producer的集合，这类Producer发送同一类消息且发送逻辑一致。如果发送的是事务消息且原始生产者在发送之后崩溃，则Broker服务器会联系同一生产者组的其他生产者实例以提交或回溯消费。</p> <h2 id="_10-消费者组-consumer-group"><a href="#_10-消费者组-consumer-group" class="header-anchor">#</a> 10 消费者组（Consumer Group）</h2> <p>同一类Consumer的集合，这类Consumer通常消费同一类消息且消费逻辑一致。消费者组使得在消息消费方面，实现负载均衡和容错的目标变得非常容易。</p> <p><strong>要注意的是，消费者组的消费者实例必须订阅完全相同的Topic。</strong></p> <p>RocketMQ 支持两种消息模式：<code>集群消费（Clustering）</code>和<code>广播消费（Broadcasting）</code>。</p> <h2 id="_11-集群消费-clustering"><a href="#_11-集群消费-clustering" class="header-anchor">#</a> 11 集群消费（Clustering）</h2> <p>集群消费模式下，相同Consumer Group的每个Consumer实例<strong>平均分摊消息</strong>。</p> <h2 id="_12-广播消费-broadcasting"><a href="#_12-广播消费-broadcasting" class="header-anchor">#</a> 12 广播消费（Broadcasting）</h2> <p>广播消费模式下，相同Consumer Group的每个Consumer实例都接收<strong>全量的消息</strong>。</p> <h2 id="_13-普通顺序消息-normal-ordered-message"><a href="#_13-普通顺序消息-normal-ordered-message" class="header-anchor">#</a> 13 普通顺序消息（Normal Ordered Message）</h2> <p>普通顺序消费模式下，消费者通过同一个消息队列（ Topic 分区，称作 Message Queue） 收到的消息是有顺序的，不同消息队列收到的消息则可能是无顺序的。</p> <h2 id="_14-严格顺序消息-strictly-ordered-message"><a href="#_14-严格顺序消息-strictly-ordered-message" class="header-anchor">#</a> 14 严格顺序消息（Strictly Ordered Message）</h2> <p>严格顺序消息模式下，消费者收到的所有消息均是有顺序的。</p> <h2 id="_15-消息-message"><a href="#_15-消息-message" class="header-anchor">#</a> 15 消息（Message）</h2> <p>消息系统所传输信息的物理载体，生产和消费数据的最小单位，每条消息必须属于一个主题。RocketMQ中每个消息拥有唯一的Message ID，且可以携带具有业务标识的Key。系统提供了通过Message ID和Key查询消息的功能。</p> <h2 id="_16-标签-tag"><a href="#_16-标签-tag" class="header-anchor">#</a> 16 标签（Tag）</h2> <p>为消息设置的标志，用于同一主题下区分不同类型的消息。来自同一业务单元的消息，可以根据不同业务目的在同一主题下设置不同标签。标签能够有效地保持代码的清晰度和连贯性，并优化RocketMQ提供的查询系统。消费者可以根据Tag实现对不同子主题的不同消费逻辑，实现更好的扩展性。</p> <h1 id="_4、搭建环境"><a href="#_4、搭建环境" class="header-anchor">#</a> 4、搭建环境</h1> <p>https://blog.csdn.net/weidong22/article/details/79246726</p> <p>为什么有序？</p> <p>如果不指定MessageQueue，默认是轮流发到不同的 MessageQueue上的，所以消费的时候就可能回乱序。</p> <p>如果指定了，就会把这批消息放在同一个MessageQueue。</p> <p>https://blog.csdn.net/leexide/article/details/80035470</p> <h1 id="_5、使用"><a href="#_5、使用" class="header-anchor">#</a> 5、使用</h1> <h2 id="_1、简单使用"><a href="#_1、简单使用" class="header-anchor">#</a> 1、简单使用</h2> <h3 id="_5-1、-加入依赖"><a href="#_5-1、-加入依赖" class="header-anchor">#</a> 5.1、 加入依赖</h3> <p>maven:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>gradle</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token key attr-name">compile</span> <span class="token value attr-value">'org.apache.rocketmq:rocketmq-client:4.3.0'</span>
</code></pre></div><h3 id="_5-2、消息发送"><a href="#_5-2、消息发送" class="header-anchor">#</a> 5.2、消息发送</h3> <p>producer消息的发送分为三种：同步消息、异步消息、单向消息。前两者的消息是可靠的，因为会有ACK应答，而单向消息 只管发送。</p> <h4 id="_1、producer端发送同步消息"><a href="#_1、producer端发送同步消息" class="header-anchor">#</a> 1、Producer端发送同步消息</h4> <p>同步消息使用广泛，如短信，一些重要的消息。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SyncProducer</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    	<span class="token comment">// 实例化消息生产者Producer</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 设置NameServer的地址</span>
    	producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 启动Producer实例</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	    <span class="token comment">// 创建消息，并指定Topic，Tag和消息体</span>
    	    <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span> <span class="token comment">/* Topic */</span><span class="token punctuation">,</span>
        	<span class="token string">&quot;TagA&quot;</span> <span class="token comment">/* Tag */</span><span class="token punctuation">,</span>
        	<span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span>DEFAULT_CHARSET<span class="token punctuation">)</span> <span class="token comment">/* Message body */</span>
        	<span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token comment">// 发送消息到一个Broker</span>
            <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 通过sendResult返回消息是否成功送达</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%n&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    	<span class="token comment">// 如果不再发送消息，关闭Producer实例。</span>
    	producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2、发送异步消息"><a href="#_2、发送异步消息" class="header-anchor">#</a> 2、发送异步消息</h4> <p>异步消息通常用在对响应时间敏感的业务场景，即发送端不能容忍长时间地等待Broker的响应。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncProducer</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    	<span class="token comment">// 实例化消息生产者Producer</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 设置NameServer的地址</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 启动Producer实例</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setRetryTimesWhenSendAsyncFailed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">int</span> messageCount <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
        <span class="token comment">// 根据消息数量实例化倒计时计算器</span>
	<span class="token keyword">final</span> <span class="token class-name">CountDownLatch2</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch2</span><span class="token punctuation">(</span>messageCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> messageCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">final</span> <span class="token keyword">int</span> index <span class="token operator">=</span> i<span class="token punctuation">;</span>
            	<span class="token comment">// 创建消息，并指定Topic，Tag和消息体</span>
                <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;OrderID188&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span>DEFAULT_CHARSET<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// SendCallback接收异步返回结果的回调</span>
                producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SendCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token class-name">SendResult</span> sendResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-10d OK %s %n&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span>
                            sendResult<span class="token punctuation">.</span><span class="token function">getMsgId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onException</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      	              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-10d Exception %s %n&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      	              e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
            	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
	<span class="token comment">// 等待5s</span>
	countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 如果不再发送消息，关闭Producer实例。</span>
    	producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3、单向发送消息"><a href="#_3、单向发送消息" class="header-anchor">#</a> 3、单向发送消息</h4> <p>这种方式主要用在不特别关心发送结果的场景，例如日志发送。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OnewayProducer</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
    	<span class="token comment">// 实例化消息生产者Producer</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 设置NameServer的地址</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 启动Producer实例</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	<span class="token comment">// 创建消息，并指定Topic，Tag和消息体</span>
        	<span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span> <span class="token comment">/* Topic */</span><span class="token punctuation">,</span>
                <span class="token string">&quot;TagA&quot;</span> <span class="token comment">/* Tag */</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span>DEFAULT_CHARSET<span class="token punctuation">)</span> <span class="token comment">/* Message body */</span>
        	<span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token comment">// 发送单向消息，没有任何返回结果</span>
        	producer<span class="token punctuation">.</span><span class="token function">sendOneway</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    	<span class="token punctuation">}</span>
    	<span class="token comment">// 如果不再发送消息，关闭Producer实例。</span>
    	producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-3-、消息消费"><a href="#_5-3-、消息消费" class="header-anchor">#</a> 5.3 、消息消费</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Consumer</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">MQClientException</span> <span class="token punctuation">{</span>

    	<span class="token comment">// 实例化消费者</span>
        <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    	<span class="token comment">// 设置NameServer的地址</span>
        consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    	<span class="token comment">// 订阅一个或者多个Topic，以及Tag来过滤需要消费的消息</span>
        consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 注册回调实现类来处理从broker拉取回来的消息</span>
        consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s Receive New Messages: %s %n&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 标记该消息已经被成功消费</span>
                <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span>CONSUME_SUCCESS<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 启动消费者实例</span>
        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer Started.%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_2、顺序消息样例"><a href="#_2、顺序消息样例" class="header-anchor">#</a> 2、顺序消息样例</h2> <p>消息有序指的是可以按照消息的发送顺序来消费(FIFO)。RocketMQ可以严格的保证消息有序，可以分为分区有序或者全局有序。</p> <p>顺序消费的原理解析，在默认的情况下消息发送会采取Round Robin轮询方式把消息发送到不同的queue(分区队列)；而消费消息的时候从多个queue上拉取消息，这种情况发送和消费是不能保证顺序。但是如果控制发送的顺序消息只依次发送到同一个queue中，消费的时候只从这个queue上依次拉取，则就保证了顺序。<strong>当发送和消费参与的queue只有一个，则是全局有序；如果多个queue参与，则为分区有序，即相对每个queue，消息都是有序的。</strong></p> <p>下面用订单进行分区有序的示例。一个订单的顺序流程是：创建、付款、推送、完成。订单号相同的消息会被先后发送到同一个队列中，消费时，同一个OrderId获取到的肯定是同一个队列。</p> <h3 id="_2-1-顺序消息生产"><a href="#_2-1-顺序消息生产" class="header-anchor">#</a> 2.1 顺序消息生产</h3> <h3 id="_2-2顺序消费消息"><a href="#_2-2顺序消费消息" class="header-anchor">#</a> 2.2顺序消费消息</h3> <p>代码参考：https://github.com/apache/rocketmq/blob/master/docs/cn/RocketMQ_Example.md#22-%E9%A1%BA%E5%BA%8F%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF</p> <h1 id="_6、故障"><a href="#_6、故障" class="header-anchor">#</a> 6、故障</h1> <h2 id="_1、nameserver-挂掉"><a href="#_1、nameserver-挂掉" class="header-anchor">#</a> 1、nameserver 挂掉</h2> <ol><li>NameServer互相独立，彼此没有通信关系，单台NameServer挂掉，不影响其他NameServer；</li> <li>broker与所有NameServer进行定时注册，以便告知NameServer自己还活着。<strong>Broker每隔30秒向所有NameServer发送心跳</strong>，心跳包含了自身的topic配置信息。NameServer每隔10秒，扫描所有还存活的broker连接，如果某个连接的最后更新时间与当前时间差值超过2分钟，则断开此连接。如果nameserver全挂了，则导致无法确定哪些broker存活，哪些broker宕机，如果broker宕机则导致消息发送失败。</li> <li>consumer随机与一个NameServer建立长连接，如果该NameServer宕机，则从NameServer列表中查找下一个进行连接。consumer主要从NameServer中根据topic查询broker的地址，查到就会缓存到客户端，并向提供topic服务的master、slave建立长连接，且定时向master、slave发送心跳。如果broker宕机，则NameServer会将其剔除，而consumer端的定时任务每30秒执行一次，会将topic对应的broker地址拉取下来，<strong>因此尽管nameserver全部宕机了，consumer依然能消费;</strong></li> <li>Producer随机与一个NameServer建立长连接，默认每隔30秒从NameServer获取topic的最新队列情况并缓存，这就表示如果某个broker master宕机，producer最多30秒才能感知，在这个期间，发往该broker master的消息将会失败。Producer会向提供topic服务的master建立长连接，且定时向master发送心跳。<strong>Producer与所有的master连接，但不能向slave写入</strong>。</li></ol> <h2 id="_2、broker挂掉"><a href="#_2、broker挂掉" class="header-anchor">#</a> 2、broker挂掉</h2> <p>broker挂掉需要根据不同的部署方式进行分析：</p> <ul><li>单个 Master</li> <li>多 Master（无salve）</li> <li>多Master多Slave（异步复制）</li> <li>多Master多Slave模式（同步双写）</li></ul> <h3 id="_1、单个-master"><a href="#_1、单个-master" class="header-anchor">#</a> 1、单个 Master</h3> <p>这种挂掉就无了，一旦Broker重启或者宕机时，会导致整个服务不可用，也不推荐使用。</p> <h3 id="_2、多-master-无salve"><a href="#_2、多-master-无salve" class="header-anchor">#</a> 2、多 Master（无salve）</h3> <p>例如 2 个 Master 或者 3 个 Master。</p> <p>当单台机器宕机期间，这台机器上<strong>未被消费的消息</strong>在机器恢复之前不可订阅，消息实时性会受到受到影响。</p> <p>假如有两个master：broker-a 和 broker-b ，假如 broker-a 宕机了，生产者和消费者都不能通信，但是消息不会丢失，应用也不会报错，只有 broker-a 重启后，才能完成消费。</p> <h3 id="_3、多master多slave-异步复制"><a href="#_3、多master多slave-异步复制" class="header-anchor">#</a> 3、多Master多Slave（异步复制）</h3> <p>每个 Master 配置一个 Slave，有多对Master-Slave，这是一种HA（高可用）模式。</p> <p>这种模式是对上一种模式 <strong>多 Master（无salve）</strong>  的优化，即使磁盘损坏，消息丢失的非常少，且消息实时性不会受影响，因为Master 宕机后，消费者仍然可以从 Slave 消费。（不需要人工干预，master挂了，消费者会自动找到 slave ）</p> <p>但是Master的宕机，在复制的过程中会导致丢失掉极少量的消息。</p> <h3 id="_4、多master多slave模式-同步双写"><a href="#_4、多master多slave模式-同步双写" class="header-anchor">#</a> 4、多Master多Slave模式（同步双写）</h3> <p>这种模式和上面类似，但在 写入的过程中，先写入master，master再写入slave，主从都写入成功了，再返回给应用。</p> <p>所以性能比异步复制模式略低，大约低 10%左右，但Master宕机情况下，消息无延迟，服务可用性与数据可用性都非常高。</p> <h2 id="结论"><a href="#结论" class="header-anchor">#</a> 结论</h2> <ol><li><strong>多master（无slave）模式</strong>是所有模式中性能最高的，但是存在当broker宕机，其未被消费的消息在节点恢复之前不可用，消息实时性受到影响；</li> <li><strong>多master多slave（异步复制）模式</strong> master节点可读可写，但是slave只能读不能写，在master宕机时，消费者可以从slave中读取消息，消息实时性不会受到影响，但是可能会有消息丢失的问题；</li> <li><strong>多master多slave（同步双写）模式</strong> 能保证数据不丢失，但是性能较低；</li></ol> <blockquote><p>要保证数据可靠，需采用 同步刷盘 和 同步双写 的方式，但性能会较其他方式低，可通过配置brokerRole和flushDiskType来实现数据可靠性；</p></blockquote> <h1 id="_7、实践问题"><a href="#_7、实践问题" class="header-anchor">#</a> 7、实践问题</h1> <h2 id="_1、生产者"><a href="#_1、生产者" class="header-anchor">#</a> 1、生产者</h2> <h3 id="_1-tags的使用"><a href="#_1-tags的使用" class="header-anchor">#</a> 1 Tags的使用</h3> <p>一个应用尽可能用一个Topic，而消息子类型则可以用tags来标识。tags可以由应用自由设置，只有生产者在发送消息设置了tags，消费方在订阅消息时才可以利用tags通过broker做消息过滤：message.setTags(&quot;TagA&quot;)。</p> <p>假如订阅了该toptic，但是tag不符合，这条消息的最终结果还是已经被消费状态（<code>CONSUMED_BUT_FILTERED</code>）。</p> <h3 id="_2-keys的使用"><a href="#_2-keys的使用" class="header-anchor">#</a> 2 Keys的使用</h3> <p>每个消息在业务层面的唯一标识码要设置到keys字段，方便将来定位消息丢失问题。服务器会为每个消息创建索引（哈希索引），应用可以通过topic、key来查询这条消息内容，以及消息被谁消费。由于是哈希索引，请务必保证key尽可能唯一，这样可以避免潜在的哈希冲突。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 订单Id   </span>
<span class="token class-name">String</span> orderId <span class="token operator">=</span> <span class="token string">&quot;20034568923546&quot;</span><span class="token punctuation">;</span>   
message<span class="token punctuation">.</span><span class="token function">setKeys</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>   
</code></pre></div><h3 id="_3-消息发送失败处理"><a href="#_3-消息发送失败处理" class="header-anchor">#</a> 3 消息发送失败处理</h3> <p>Producer的send方法本身支持内部重试，重试逻辑如下：</p> <ul><li>至多重试2次。</li> <li>如果同步模式发送失败，则轮转到下一个Broker，如果异步模式发送失败，则只会在当前Broker进行重试。这个方法的总耗时时间不超过sendMsgTimeout设置的值，默认10s。</li> <li>如果本身向broker发送消息产生超时异常，就不会再重试。</li></ul> <p>以上策略也是在一定程度上保证了消息可以发送成功。如果业务对消息可靠性要求比较高，建议应用增加相应的重试逻辑：比如调用send同步方法发送失败时，则尝试将消息存储到db，然后由后台线程定时重试，确保消息一定到达Broker。</p> <h3 id="_4、日志打印"><a href="#_4、日志打印" class="header-anchor">#</a> 4、日志打印</h3> <p>消息发送务必打印SendResult和key字段，send消息方法只要不抛异常，就代表发送成功。发送成功会有多个状态，在sendResult里定义：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">SendStatus</span> <span class="token punctuation">{</span>
    SEND_OK<span class="token punctuation">,</span>
    FLUSH_DISK_TIMEOUT<span class="token punctuation">,</span>
    FLUSH_SLAVE_TIMEOUT<span class="token punctuation">,</span>
    SLAVE_NOT_AVAILABLE<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>SEND_OK</li></ul> <p>消息发送成功。要注意的是消息发送成功也不意味着它是可靠的。要确保不会丢失任何消息，还应启用同步Master服务器或同步刷盘，即SYNC_MASTER或SYNC_FLUSH。</p> <ul><li>FLUSH_DISK_TIMEOUT</li></ul> <p>消息发送成功但是服务器刷盘超时。此时消息已经进入服务器队列（内存），只有服务器宕机，消息才会丢失。消息存储配置参数中可以设置刷盘方式和同步刷盘时间长度，如果Broker服务器设置了刷盘方式为同步刷盘，即FlushDiskType=SYNC_FLUSH（默认为异步刷盘方式），当Broker服务器未在同步刷盘时间内（默认为5s）完成刷盘，则将返回该状态——刷盘超时。</p> <ul><li>FLUSH_SLAVE_TIMEOUT</li></ul> <p>消息发送成功，但是服务器同步到Slave时超时。此时消息已经进入服务器队列，只有服务器宕机，消息才会丢失。如果Broker服务器的角色是同步Master，即SYNC_MASTER（默认是异步Master即ASYNC_MASTER），并且从Broker服务器未在同步刷盘时间（默认为5秒）内完成与主服务器的同步，则将返回该状态——数据同步到Slave服务器超时。</p> <ul><li>SLAVE_NOT_AVAILABLE</li></ul> <p>消息发送成功，但是此时Slave不可用。如果Broker服务器的角色是同步Master，即SYNC_MASTER（默认是异步Master服务器即ASYNC_MASTER），但没有配置slave Broker服务器，则将返回该状态——无Slave服务器可用。</p> <h2 id="_2、消费者"><a href="#_2、消费者" class="header-anchor">#</a> 2、消费者</h2> <h3 id="_2-1-消费过程幂等"><a href="#_2-1-消费过程幂等" class="header-anchor">#</a> 2.1 消费过程幂等</h3> <p>RocketMQ无法避免消息重复（Exactly-Once），所以如果业务对消费重复非常敏感，务必要在业务层面进行去重处理。可以借助关系数据库进行去重。首先需要确定消息的唯一键，可以是msgId，也可以是消息内容中的唯一标识字段，例如订单Id等。在消费之前判断唯一键是否在关系数据库中存在。如果不存在则插入，并消费，否则跳过。（实际过程要考虑原子性问题，判断是否存在可以尝试插入，如果报主键冲突，则插入失败，直接跳过）</p> <p>msgId一定是全局唯一标识符，但是实际使用中，可能会存在相同的消息有两个不同msgId的情况（消费者主动重发、因客户端重投机制导致的重复等），这种情况就需要使业务字段进行重复消费。</p></div></div> <div class="read-more-wrap" style="display:none;position:absolute;bottom:0px;z-index:9999;width:100%;margin-top:-100px;font-family:PingFangSC-Regular, sans-serif;"><div id="read-more-mask" style="position: relative; height: 300px; background:-webkit-gradient(linear, 0 0%, 0 50%, from(rgba(255, 255, 255, 0)), to(rgb(255 255 255 / 82%)));"></div> <a id="read-more-btn" target="_self" style="position: absolute; left: 50%; top: 50%; bottom: 30px; transform: translate(-50%, -50%); width: 160px; height: 36px; line-height: 36px; font-size: 15px; text-align: center; border: 1px solid rgb(222, 104, 109); color: rgb(222, 104, 109); background: rgb(255, 255, 255); cursor: pointer; border-radius: 6px;"><span id="read-more-text">阅读全文</span> <br style="display:none;"> <span id="read-more-text_remainder"></span></a> <div id="btw-modal-wrap" style="display: none;"><div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0);"></div> <div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;"><span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 34px; font-size: 34px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">×</span> <p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px;">
                  （为防止恶意爬虫）
                  <br>
                  扫码或搜索：<span style="color: #E9405A; font-weight: bold;">HelloCoder</span> <br>发送：<span id="fustack-token" class="token" style="color: #e9415a; font-weight: bold; font-size: 17px; margin-bottom: 45px;">290992</span> <br>即可<span style="color: #e9415a; font-weight: bold;">永久解锁</span>本站全部文章</p> <img src="/img/site/HelloCoder.png" style="width: 180px; margin-top: 10px; margin-bottom: 30px; border: 8px solid rgb(230, 230, 230);"> <div class="input-password"><input id="input_password" autocomplete="off" placeholder="请输入密码"> <span><a id="check_password" target="_self" class="btn-password"> 解锁 </a></span></div></div></div></div>  <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=RocketMQ" title="标签">#RocketMQ</a><a href="/tags/?tag=%E5%85%A5%E9%97%A8" title="标签">#入门</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024-01-03 15:30:24</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/%E3%80%8ALeetCode%20101%E3%80%8B/"><div>
            《LeetCode 101》
            <!----></div></a> <span class="date">01-03</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/%E3%80%8ALeetCode%20CookBook%E3%80%8B/"><div>
            《LeetCode CookBook》
            <!----></div></a> <span class="date">01-03</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/IDEA%E3%80%81Golang%E3%80%81Pycharm%E7%A0%B4%E8%A7%A3%E5%AE%89%E8%A3%85/"><div>
            IDEA、Golang、Pycharm破解安装
            <!----></div></a> <span class="date">01-03</span></dt></dl> <dl><dd></dd> <dt><a href="/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:huangyongwen0306@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://www.zhihu.com/people/dai-ma-coder" title="知乎" target="_blank" class="iconfont icon-zhihu"></a><a href="/img/site/HelloCoder.png" title="微信公众号" target="_blank" class="iconfont icon-weixin"></a></div> 
    Theme by
    <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
      | Copyright © 2020-2024
      <span>码农阿雨</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f3da103e.js" defer></script><script src="/assets/js/3.d853b231.js" defer></script><script src="/assets/js/4.7c2b82a8.js" defer></script><script src="/assets/js/254.0c73dcd5.js" defer></script>
  </body>
</html>
