<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>如何保障生产端消息投递成功？ | HelloCoder</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/img/favicon.ico">
    <script charset="utf-8" async="async" src="/js/jquery.min.js"></script>
    <script charset="utf-8" async="async" src="/js/global.js"></script>
    <script charset="utf-8" async="async" src="/js/fingerprint2.min.js"></script>
    <script charset="utf-8" async="async" src="https://readmore.openwrite.cn/js/readmore.js"></script>
    <script charset="utf-8" async="async" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <script>
              var _hmt = _hmt || [];
              (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?b673363a2df767abd890cd6918642392";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
              })();
            </script>
    <meta name="description" content="java面试,java学习,面试指南,Java小白求职之路">
    <meta name="keywords" content="java面试,java面试题目,java核心知识,面试指南,Java小白求职之路">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.c9315ac1.css" as="style"><link rel="preload" href="/assets/js/app.bbda35f8.js" as="script"><link rel="preload" href="/assets/js/3.20e33b3c.js" as="script"><link rel="preload" href="/assets/js/4.2d053232.js" as="script"><link rel="preload" href="/assets/js/65.dbed26c0.js" as="script"><link rel="prefetch" href="/assets/js/10.e16609c8.js"><link rel="prefetch" href="/assets/js/100.eb5fd92e.js"><link rel="prefetch" href="/assets/js/101.69c81281.js"><link rel="prefetch" href="/assets/js/102.b54f4f2a.js"><link rel="prefetch" href="/assets/js/103.1c1bb49b.js"><link rel="prefetch" href="/assets/js/104.0de4bafb.js"><link rel="prefetch" href="/assets/js/105.352ea967.js"><link rel="prefetch" href="/assets/js/106.5e37632f.js"><link rel="prefetch" href="/assets/js/107.fa43d977.js"><link rel="prefetch" href="/assets/js/108.3b456305.js"><link rel="prefetch" href="/assets/js/109.e88e327f.js"><link rel="prefetch" href="/assets/js/11.dd8758d2.js"><link rel="prefetch" href="/assets/js/110.a70f565f.js"><link rel="prefetch" href="/assets/js/111.25d3cf70.js"><link rel="prefetch" href="/assets/js/112.b7c78297.js"><link rel="prefetch" href="/assets/js/113.23e5723d.js"><link rel="prefetch" href="/assets/js/114.9fb0d410.js"><link rel="prefetch" href="/assets/js/115.3ca906a7.js"><link rel="prefetch" href="/assets/js/116.6129f5a4.js"><link rel="prefetch" href="/assets/js/117.f795ea54.js"><link rel="prefetch" href="/assets/js/118.8dddcb96.js"><link rel="prefetch" href="/assets/js/119.9a548804.js"><link rel="prefetch" href="/assets/js/12.8a4a11cb.js"><link rel="prefetch" href="/assets/js/120.42e061da.js"><link rel="prefetch" href="/assets/js/121.26bc020d.js"><link rel="prefetch" href="/assets/js/122.426e2509.js"><link rel="prefetch" href="/assets/js/123.b2e4ad35.js"><link rel="prefetch" href="/assets/js/124.be783bf4.js"><link rel="prefetch" href="/assets/js/125.bfe73453.js"><link rel="prefetch" href="/assets/js/126.1def984e.js"><link rel="prefetch" href="/assets/js/127.13629a9f.js"><link rel="prefetch" href="/assets/js/128.53ce1b73.js"><link rel="prefetch" href="/assets/js/129.4f94cdc2.js"><link rel="prefetch" href="/assets/js/13.4fbdc584.js"><link rel="prefetch" href="/assets/js/130.00936aa3.js"><link rel="prefetch" href="/assets/js/131.f21baedf.js"><link rel="prefetch" href="/assets/js/132.f22d8e4c.js"><link rel="prefetch" href="/assets/js/133.5a80fc90.js"><link rel="prefetch" href="/assets/js/134.9e8f762c.js"><link rel="prefetch" href="/assets/js/135.596cba16.js"><link rel="prefetch" href="/assets/js/136.beb7123b.js"><link rel="prefetch" href="/assets/js/137.3a2cae79.js"><link rel="prefetch" href="/assets/js/138.7499b790.js"><link rel="prefetch" href="/assets/js/139.4411a0cd.js"><link rel="prefetch" href="/assets/js/14.2b7aa6d2.js"><link rel="prefetch" href="/assets/js/140.fbfc70e8.js"><link rel="prefetch" href="/assets/js/141.bdd979ce.js"><link rel="prefetch" href="/assets/js/142.cd618d51.js"><link rel="prefetch" href="/assets/js/143.67708a7c.js"><link rel="prefetch" href="/assets/js/144.d3297290.js"><link rel="prefetch" href="/assets/js/145.13d3a639.js"><link rel="prefetch" href="/assets/js/146.83e2aa40.js"><link rel="prefetch" href="/assets/js/147.881b7829.js"><link rel="prefetch" href="/assets/js/148.572fb3b2.js"><link rel="prefetch" href="/assets/js/149.b378a4f9.js"><link rel="prefetch" href="/assets/js/15.a882ccf5.js"><link rel="prefetch" href="/assets/js/150.9dfbaeaf.js"><link rel="prefetch" href="/assets/js/151.b3edf087.js"><link rel="prefetch" href="/assets/js/152.f9a07825.js"><link rel="prefetch" href="/assets/js/153.e405a84d.js"><link rel="prefetch" href="/assets/js/154.fd9da21e.js"><link rel="prefetch" href="/assets/js/155.5a7629a7.js"><link rel="prefetch" href="/assets/js/156.d160d34f.js"><link rel="prefetch" href="/assets/js/157.59a05d7e.js"><link rel="prefetch" href="/assets/js/158.cb45ae2d.js"><link rel="prefetch" href="/assets/js/159.be464f24.js"><link rel="prefetch" href="/assets/js/16.40d95b1f.js"><link rel="prefetch" href="/assets/js/160.fcfa5bd1.js"><link rel="prefetch" href="/assets/js/161.6267504b.js"><link rel="prefetch" href="/assets/js/162.210f6cca.js"><link rel="prefetch" href="/assets/js/163.16ef03f2.js"><link rel="prefetch" href="/assets/js/164.39de041d.js"><link rel="prefetch" href="/assets/js/165.eb8543e3.js"><link rel="prefetch" href="/assets/js/166.fbbedc9a.js"><link rel="prefetch" href="/assets/js/167.ef030460.js"><link rel="prefetch" href="/assets/js/168.6941b34f.js"><link rel="prefetch" href="/assets/js/169.11906e6d.js"><link rel="prefetch" href="/assets/js/17.b401c370.js"><link rel="prefetch" href="/assets/js/170.a050955d.js"><link rel="prefetch" href="/assets/js/171.1b4e0c13.js"><link rel="prefetch" href="/assets/js/172.f99159e2.js"><link rel="prefetch" href="/assets/js/173.7fb6065b.js"><link rel="prefetch" href="/assets/js/174.e0d050ea.js"><link rel="prefetch" href="/assets/js/175.856cc09d.js"><link rel="prefetch" href="/assets/js/176.f577e7ca.js"><link rel="prefetch" href="/assets/js/177.0c7bcde1.js"><link rel="prefetch" href="/assets/js/178.063e07d6.js"><link rel="prefetch" href="/assets/js/179.5c5d7658.js"><link rel="prefetch" href="/assets/js/18.7ef38216.js"><link rel="prefetch" href="/assets/js/180.caa5bb0d.js"><link rel="prefetch" href="/assets/js/181.e8d06622.js"><link rel="prefetch" href="/assets/js/182.0cd96bd7.js"><link rel="prefetch" href="/assets/js/183.25dff0cd.js"><link rel="prefetch" href="/assets/js/184.ea3ae18b.js"><link rel="prefetch" href="/assets/js/185.ff8f294a.js"><link rel="prefetch" href="/assets/js/186.8c348589.js"><link rel="prefetch" href="/assets/js/187.2d814b8c.js"><link rel="prefetch" href="/assets/js/188.78fd377b.js"><link rel="prefetch" href="/assets/js/189.e3124d2e.js"><link rel="prefetch" href="/assets/js/19.222d89e7.js"><link rel="prefetch" href="/assets/js/190.c55219d6.js"><link rel="prefetch" href="/assets/js/191.918bf88a.js"><link rel="prefetch" href="/assets/js/192.d8c618f4.js"><link rel="prefetch" href="/assets/js/193.32899137.js"><link rel="prefetch" href="/assets/js/194.3a89302f.js"><link rel="prefetch" href="/assets/js/195.95f2ae50.js"><link rel="prefetch" href="/assets/js/196.87290184.js"><link rel="prefetch" href="/assets/js/197.17520748.js"><link rel="prefetch" href="/assets/js/198.9fc4d4f0.js"><link rel="prefetch" href="/assets/js/199.c63eb279.js"><link rel="prefetch" href="/assets/js/20.1ff17d05.js"><link rel="prefetch" href="/assets/js/200.b473ba30.js"><link rel="prefetch" href="/assets/js/201.c45a54d8.js"><link rel="prefetch" href="/assets/js/202.89ce6951.js"><link rel="prefetch" href="/assets/js/203.9f6544dd.js"><link rel="prefetch" href="/assets/js/204.04ee0df2.js"><link rel="prefetch" href="/assets/js/205.f04b944b.js"><link rel="prefetch" href="/assets/js/206.da40397e.js"><link rel="prefetch" href="/assets/js/207.383e9917.js"><link rel="prefetch" href="/assets/js/208.756af69a.js"><link rel="prefetch" href="/assets/js/209.14cfed7d.js"><link rel="prefetch" href="/assets/js/21.f8c5da70.js"><link rel="prefetch" href="/assets/js/210.24f6a697.js"><link rel="prefetch" href="/assets/js/211.c2f04f2a.js"><link rel="prefetch" href="/assets/js/212.211bb2e0.js"><link rel="prefetch" href="/assets/js/213.44b11952.js"><link rel="prefetch" href="/assets/js/214.28fd489f.js"><link rel="prefetch" href="/assets/js/215.78dcb908.js"><link rel="prefetch" href="/assets/js/216.98af1415.js"><link rel="prefetch" href="/assets/js/217.019d9d09.js"><link rel="prefetch" href="/assets/js/218.41cbfaea.js"><link rel="prefetch" href="/assets/js/219.7558f40e.js"><link rel="prefetch" href="/assets/js/22.603f48ad.js"><link rel="prefetch" href="/assets/js/220.b40bfb0e.js"><link rel="prefetch" href="/assets/js/221.f2e61f3e.js"><link rel="prefetch" href="/assets/js/222.2259962c.js"><link rel="prefetch" href="/assets/js/223.213784cf.js"><link rel="prefetch" href="/assets/js/224.1a84fa40.js"><link rel="prefetch" href="/assets/js/225.57b1150e.js"><link rel="prefetch" href="/assets/js/226.eb27fe4e.js"><link rel="prefetch" href="/assets/js/227.a9e14067.js"><link rel="prefetch" href="/assets/js/228.de3ebe83.js"><link rel="prefetch" href="/assets/js/229.bd8bedd3.js"><link rel="prefetch" href="/assets/js/23.312324bb.js"><link rel="prefetch" href="/assets/js/230.e65042be.js"><link rel="prefetch" href="/assets/js/231.94f907c9.js"><link rel="prefetch" href="/assets/js/232.639cdaf5.js"><link rel="prefetch" href="/assets/js/233.4b68768d.js"><link rel="prefetch" href="/assets/js/234.35c55c4d.js"><link rel="prefetch" href="/assets/js/235.43f58c91.js"><link rel="prefetch" href="/assets/js/236.b79f4c04.js"><link rel="prefetch" href="/assets/js/237.280c6824.js"><link rel="prefetch" href="/assets/js/238.6efa0742.js"><link rel="prefetch" href="/assets/js/239.109849ab.js"><link rel="prefetch" href="/assets/js/24.34833301.js"><link rel="prefetch" href="/assets/js/240.157382d2.js"><link rel="prefetch" href="/assets/js/241.7a770f08.js"><link rel="prefetch" href="/assets/js/242.c888f660.js"><link rel="prefetch" href="/assets/js/243.f767439f.js"><link rel="prefetch" href="/assets/js/244.19254896.js"><link rel="prefetch" href="/assets/js/245.892fd1d2.js"><link rel="prefetch" href="/assets/js/246.7aff1c74.js"><link rel="prefetch" href="/assets/js/247.2a100856.js"><link rel="prefetch" href="/assets/js/248.c0cb7f9a.js"><link rel="prefetch" href="/assets/js/249.c6fa52b7.js"><link rel="prefetch" href="/assets/js/25.4176f599.js"><link rel="prefetch" href="/assets/js/250.385a0581.js"><link rel="prefetch" href="/assets/js/251.11848067.js"><link rel="prefetch" href="/assets/js/252.3a2598f0.js"><link rel="prefetch" href="/assets/js/253.22f4955f.js"><link rel="prefetch" href="/assets/js/254.5e6d0620.js"><link rel="prefetch" href="/assets/js/255.e33c78d1.js"><link rel="prefetch" href="/assets/js/256.45744f22.js"><link rel="prefetch" href="/assets/js/257.bc8dcc46.js"><link rel="prefetch" href="/assets/js/258.a1c52b00.js"><link rel="prefetch" href="/assets/js/259.f762dd0b.js"><link rel="prefetch" href="/assets/js/26.d991adb4.js"><link rel="prefetch" href="/assets/js/260.95b8b41e.js"><link rel="prefetch" href="/assets/js/261.eb31ec50.js"><link rel="prefetch" href="/assets/js/262.fd097b29.js"><link rel="prefetch" href="/assets/js/263.c259c760.js"><link rel="prefetch" href="/assets/js/264.60c29b9d.js"><link rel="prefetch" href="/assets/js/265.9dd240d8.js"><link rel="prefetch" href="/assets/js/266.823eb3ed.js"><link rel="prefetch" href="/assets/js/267.e037bcf3.js"><link rel="prefetch" href="/assets/js/268.05c315e4.js"><link rel="prefetch" href="/assets/js/269.6f2f3ee6.js"><link rel="prefetch" href="/assets/js/27.af0b7fa5.js"><link rel="prefetch" href="/assets/js/270.0aac2e6e.js"><link rel="prefetch" href="/assets/js/271.1083f77d.js"><link rel="prefetch" href="/assets/js/272.8b757b61.js"><link rel="prefetch" href="/assets/js/273.c2ab81fc.js"><link rel="prefetch" href="/assets/js/274.7314b412.js"><link rel="prefetch" href="/assets/js/275.555b50ae.js"><link rel="prefetch" href="/assets/js/276.0459fda7.js"><link rel="prefetch" href="/assets/js/277.8e875de1.js"><link rel="prefetch" href="/assets/js/278.7e25cc61.js"><link rel="prefetch" href="/assets/js/279.7cdd9d82.js"><link rel="prefetch" href="/assets/js/28.627adfff.js"><link rel="prefetch" href="/assets/js/280.1d9d00da.js"><link rel="prefetch" href="/assets/js/281.eda98eea.js"><link rel="prefetch" href="/assets/js/282.cdd07532.js"><link rel="prefetch" href="/assets/js/283.06f83b57.js"><link rel="prefetch" href="/assets/js/284.010df8a8.js"><link rel="prefetch" href="/assets/js/285.41654a5c.js"><link rel="prefetch" href="/assets/js/286.abd282fd.js"><link rel="prefetch" href="/assets/js/287.eb2284d3.js"><link rel="prefetch" href="/assets/js/288.4b6a3f57.js"><link rel="prefetch" href="/assets/js/289.34d9dfe7.js"><link rel="prefetch" href="/assets/js/29.b1834777.js"><link rel="prefetch" href="/assets/js/290.3a8c3e7e.js"><link rel="prefetch" href="/assets/js/291.1b3b3878.js"><link rel="prefetch" href="/assets/js/292.a5b115d8.js"><link rel="prefetch" href="/assets/js/293.6f6a1d0f.js"><link rel="prefetch" href="/assets/js/294.dbbd8bec.js"><link rel="prefetch" href="/assets/js/295.a1e356fd.js"><link rel="prefetch" href="/assets/js/296.7440a03f.js"><link rel="prefetch" href="/assets/js/297.3aacfe32.js"><link rel="prefetch" href="/assets/js/298.939a6456.js"><link rel="prefetch" href="/assets/js/299.c6e1b4a3.js"><link rel="prefetch" href="/assets/js/30.72bb605b.js"><link rel="prefetch" href="/assets/js/300.18c1b2b0.js"><link rel="prefetch" href="/assets/js/301.b98b09fc.js"><link rel="prefetch" href="/assets/js/302.b2533675.js"><link rel="prefetch" href="/assets/js/303.74018500.js"><link rel="prefetch" href="/assets/js/304.3082e120.js"><link rel="prefetch" href="/assets/js/305.5f98164f.js"><link rel="prefetch" href="/assets/js/306.79397873.js"><link rel="prefetch" href="/assets/js/307.7f55729a.js"><link rel="prefetch" href="/assets/js/308.662d7f91.js"><link rel="prefetch" href="/assets/js/309.285d2ff5.js"><link rel="prefetch" href="/assets/js/31.948a268e.js"><link rel="prefetch" href="/assets/js/310.7da538d6.js"><link rel="prefetch" href="/assets/js/311.f6d8aaff.js"><link rel="prefetch" href="/assets/js/312.7f5e5658.js"><link rel="prefetch" href="/assets/js/313.181ab6eb.js"><link rel="prefetch" href="/assets/js/314.f4b0bfd8.js"><link rel="prefetch" href="/assets/js/315.0b5739fa.js"><link rel="prefetch" href="/assets/js/316.2b192f85.js"><link rel="prefetch" href="/assets/js/317.cfbd8b62.js"><link rel="prefetch" href="/assets/js/318.cc6b603c.js"><link rel="prefetch" href="/assets/js/319.affcc9e2.js"><link rel="prefetch" href="/assets/js/32.d4e67785.js"><link rel="prefetch" href="/assets/js/320.514af124.js"><link rel="prefetch" href="/assets/js/321.c96c6216.js"><link rel="prefetch" href="/assets/js/322.00a6ddf5.js"><link rel="prefetch" href="/assets/js/323.7d5ef762.js"><link rel="prefetch" href="/assets/js/324.f918312a.js"><link rel="prefetch" href="/assets/js/325.6622bb79.js"><link rel="prefetch" href="/assets/js/326.31136e45.js"><link rel="prefetch" href="/assets/js/33.92bd7f2c.js"><link rel="prefetch" href="/assets/js/34.57443e03.js"><link rel="prefetch" href="/assets/js/35.457d8c75.js"><link rel="prefetch" href="/assets/js/36.4032abc9.js"><link rel="prefetch" href="/assets/js/37.db364152.js"><link rel="prefetch" href="/assets/js/38.dff0dfcf.js"><link rel="prefetch" href="/assets/js/39.583934cc.js"><link rel="prefetch" href="/assets/js/40.c0f84169.js"><link rel="prefetch" href="/assets/js/41.54209d4d.js"><link rel="prefetch" href="/assets/js/42.06b4f6ff.js"><link rel="prefetch" href="/assets/js/43.a35fc5b0.js"><link rel="prefetch" href="/assets/js/44.55f1b855.js"><link rel="prefetch" href="/assets/js/45.24f336a4.js"><link rel="prefetch" href="/assets/js/46.06e33110.js"><link rel="prefetch" href="/assets/js/47.d7cfbcaf.js"><link rel="prefetch" href="/assets/js/48.39f90d14.js"><link rel="prefetch" href="/assets/js/49.de8e84bc.js"><link rel="prefetch" href="/assets/js/5.d09b8955.js"><link rel="prefetch" href="/assets/js/50.f7df97cd.js"><link rel="prefetch" href="/assets/js/51.3a4be74c.js"><link rel="prefetch" href="/assets/js/52.8f66e6a6.js"><link rel="prefetch" href="/assets/js/53.616fafdf.js"><link rel="prefetch" href="/assets/js/54.96535314.js"><link rel="prefetch" href="/assets/js/55.f370569f.js"><link rel="prefetch" href="/assets/js/56.bcf82a77.js"><link rel="prefetch" href="/assets/js/57.8d391482.js"><link rel="prefetch" href="/assets/js/58.7bafc721.js"><link rel="prefetch" href="/assets/js/59.ac213b30.js"><link rel="prefetch" href="/assets/js/6.d561e644.js"><link rel="prefetch" href="/assets/js/60.64cbcdc5.js"><link rel="prefetch" href="/assets/js/61.32f09962.js"><link rel="prefetch" href="/assets/js/62.5d738e26.js"><link rel="prefetch" href="/assets/js/63.c5cde0b3.js"><link rel="prefetch" href="/assets/js/64.a6aeff30.js"><link rel="prefetch" href="/assets/js/66.08da53d4.js"><link rel="prefetch" href="/assets/js/67.cbd68e69.js"><link rel="prefetch" href="/assets/js/68.256c003b.js"><link rel="prefetch" href="/assets/js/69.252d2432.js"><link rel="prefetch" href="/assets/js/7.78ec3ee2.js"><link rel="prefetch" href="/assets/js/70.d354b7a8.js"><link rel="prefetch" href="/assets/js/71.c70a1d39.js"><link rel="prefetch" href="/assets/js/72.2fd75c24.js"><link rel="prefetch" href="/assets/js/73.895568a7.js"><link rel="prefetch" href="/assets/js/74.b33e3d2a.js"><link rel="prefetch" href="/assets/js/75.dae4c65b.js"><link rel="prefetch" href="/assets/js/76.de1b2b33.js"><link rel="prefetch" href="/assets/js/77.8bd5192c.js"><link rel="prefetch" href="/assets/js/78.75ff44ee.js"><link rel="prefetch" href="/assets/js/79.4edeb95b.js"><link rel="prefetch" href="/assets/js/8.469ec99d.js"><link rel="prefetch" href="/assets/js/80.2b78f4ea.js"><link rel="prefetch" href="/assets/js/81.8d477429.js"><link rel="prefetch" href="/assets/js/82.f860fb6f.js"><link rel="prefetch" href="/assets/js/83.2ea2901d.js"><link rel="prefetch" href="/assets/js/84.22ed1aa0.js"><link rel="prefetch" href="/assets/js/85.737a4671.js"><link rel="prefetch" href="/assets/js/86.b2091a6f.js"><link rel="prefetch" href="/assets/js/87.cb543deb.js"><link rel="prefetch" href="/assets/js/88.ac7fb1e6.js"><link rel="prefetch" href="/assets/js/89.e7048731.js"><link rel="prefetch" href="/assets/js/9.ea67d432.js"><link rel="prefetch" href="/assets/js/90.52b056c7.js"><link rel="prefetch" href="/assets/js/91.6bc1b42c.js"><link rel="prefetch" href="/assets/js/92.62c0a28f.js"><link rel="prefetch" href="/assets/js/93.54a03bd8.js"><link rel="prefetch" href="/assets/js/94.9f8385e5.js"><link rel="prefetch" href="/assets/js/95.423dbb2b.js"><link rel="prefetch" href="/assets/js/96.b99f6198.js"><link rel="prefetch" href="/assets/js/97.b7aef4cf.js"><link rel="prefetch" href="/assets/js/98.416cfeb6.js"><link rel="prefetch" href="/assets/js/99.30f925a8.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.0b428337.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c9315ac1.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/site/logo.png" alt="HelloCoder" class="logo"> <span class="site-name can-hide">HelloCoder</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/LearnJavaToFindAJob_README/" class="nav-link">《Java小白求职之路》</a></div><div class="nav-item"><a href="/pages/PureJavaCoderRoad_README/" class="nav-link">《小白学Java》</a></div><div class="nav-item"><a href="/pages/Java%E5%B8%B8%E7%94%A8%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" class="nav-link">脚手架工具</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机资源" class="dropdown-title"><!----> <span class="title" style="display:;">计算机资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/awesome-programming-resources/" class="nav-link">一些免费计算机资源</a></li><li class="dropdown-item"><!----> <a href="/pages/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%AF%95%E8%AE%BE%E7%9A%84%E4%B8%80%E4%BA%9B%E5%BB%BA%E8%AE%AE/" class="nav-link">毕设建议</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专栏系列" class="dropdown-title"><!----> <span class="title" style="display:;">专栏系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/%EF%BC%88%E4%B8%80%EF%BC%89%E7%BA%BF%E7%A8%8B%E6%98%AF%E4%BB%80%E4%B9%88/" class="nav-link">《从0到1学习Java多线程》</a></li><li class="dropdown-item"><!----> <a href="/pages/%EF%BC%881%EF%BC%89%E9%80%89%E6%8B%A9%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="nav-link">《从0到1搭建服务器》</a></li></ul></div></div><div class="nav-item"><a href="/pages/Java%E4%B9%A6%E6%9C%AC%E6%8E%A8%E8%8D%90/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/pages/%E5%85%B3%E4%BA%8E%E6%88%91/" class="nav-link">关于作者</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/LearnJavaToFindAJob_README/" class="nav-link">《Java小白求职之路》</a></div><div class="nav-item"><a href="/pages/PureJavaCoderRoad_README/" class="nav-link">《小白学Java》</a></div><div class="nav-item"><a href="/pages/Java%E5%B8%B8%E7%94%A8%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" class="nav-link">脚手架工具</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机资源" class="dropdown-title"><!----> <span class="title" style="display:;">计算机资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/awesome-programming-resources/" class="nav-link">一些免费计算机资源</a></li><li class="dropdown-item"><!----> <a href="/pages/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%AF%95%E8%AE%BE%E7%9A%84%E4%B8%80%E4%BA%9B%E5%BB%BA%E8%AE%AE/" class="nav-link">毕设建议</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专栏系列" class="dropdown-title"><!----> <span class="title" style="display:;">专栏系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/%EF%BC%88%E4%B8%80%EF%BC%89%E7%BA%BF%E7%A8%8B%E6%98%AF%E4%BB%80%E4%B9%88/" class="nav-link">《从0到1学习Java多线程》</a></li><li class="dropdown-item"><!----> <a href="/pages/%EF%BC%881%EF%BC%89%E9%80%89%E6%8B%A9%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="nav-link">《从0到1搭建服务器》</a></li></ul></div></div><div class="nav-item"><a href="/pages/Java%E4%B9%A6%E6%9C%AC%E6%8E%A8%E8%8D%90/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/pages/%E5%85%B3%E4%BA%8E%E6%88%91/" class="nav-link">关于作者</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>《LearnJavaToFindAJob》</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>导读</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>【初级】6~12k档</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>【中级】12k-26k档</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>JVM进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading open"><span>Java进阶</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ConcurrentHashMap%E9%9D%A2%E8%AF%95%E9%A2%98/" class="sidebar-link">ConcurrentHashMap面试题</a></li><li><a href="/pages/CopyOnWriteArrayList%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" class="sidebar-link">CopyOnWriteArrayList的实现原理</a></li><li><a href="/pages/HashMap%E7%9A%84put%E8%BF%87%E7%A8%8B%E6%98%AF%E6%80%8E%E4%B9%88%E6%A0%B7%E7%9A%84%EF%BC%9F/" class="sidebar-link">HashMap的put过程是怎么样的？</a></li><li><a href="/pages/IO%E6%A8%A1%E5%9E%8B%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F/" class="sidebar-link">IO模型有哪些？</a></li><li><a href="/pages/ThreadLocal%E7%9A%84%E5%8E%9F%E7%90%86/" class="sidebar-link">ThreadLocal的原理</a></li><li><a href="/pages/valueOf%E3%80%81(String)%E5%BC%BA%E8%BD%AC%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%EF%BC%9F/" class="sidebar-link">valueOf、(String)强转有什么区别？</a></li><li><a href="/pages/%E4%B8%BA%E4%BB%80%E4%B9%88%E5%9C%A8lambda%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%9A%84%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E5%BF%85%E9%A1%BB%E6%98%AFfinal%E6%88%96%E6%9C%89%E6%95%88final/" class="sidebar-link">为什么在lambda中使用的局部变量必须是final或有效final</a></li><li><a href="/pages/%E4%BD%A0%E7%9F%A5%E9%81%93%E5%A6%82%E4%BD%95%E6%9B%B4%E6%96%B0%E7%BC%93%E5%AD%98%E5%90%97%EF%BC%9F%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E7%BC%93%E5%AD%98%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%8C%E5%86%99%E4%B8%80%E8%87%B4%E6%80%A7%EF%BC%9F/" class="sidebar-link">你知道如何更新缓存吗？如何保证缓存和数据库双写一致性？</a></li><li><a href="/pages/%E5%85%AB%E8%82%A1%E6%96%87%E4%B9%8BReentrantLock/" class="sidebar-link">八股文之ReentrantLock</a></li><li><a href="/pages/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" class="sidebar-link">分布式事务</a></li><li><a href="/pages/%E5%A6%82%E4%BD%95%E4%BF%9D%E9%9A%9C%E7%94%9F%E4%BA%A7%E7%AB%AF%E6%B6%88%E6%81%AF%E6%8A%95%E9%80%92%E6%88%90%E5%8A%9F%EF%BC%9F/" aria-current="page" class="active sidebar-link">如何保障生产端消息投递成功？</a></li><li><a href="/pages/%E5%A6%82%E4%BD%95%E6%89%8B%E5%8A%A8%E8%A7%A6%E5%8F%91%E5%85%A8%E9%87%8F%E5%9B%9E%E6%94%B6%E5%9E%83%E5%9C%BE%EF%BC%8C%E5%A6%82%E4%BD%95%E7%AB%8B%E5%8D%B3%E8%A7%A6%E5%8F%91%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" class="sidebar-link">如何手动触发全量回收垃圾，如何立即触发垃圾回收</a></li><li><a href="/pages/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8ThreadLocal%EF%BC%9F/" class="sidebar-link">数据库连接池为什么要使用ThreadLocal？</a></li><li><a href="/pages/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%B8%AD%E5%A4%9A%E4%BD%99%E7%9A%84%E7%BA%BF%E7%A8%8B%E6%98%AF%E5%A6%82%E4%BD%95%E5%9B%9E%E6%94%B6%E7%9A%84/" class="sidebar-link">线程池中多余的线程是如何回收的</a></li><li><a href="/pages/%E8%B0%88%E8%B0%88%E4%BD%A0%E5%AF%B9AQS%E7%9A%84%E7%90%86%E8%A7%A3%20/" class="sidebar-link">谈谈你对AQS的理解</a></li><li><a href="/pages/%E8%B0%88%E8%B0%88%E4%BD%A0%E5%AF%B9CAS%E7%9A%84%E7%90%86%E8%A7%A3/" class="sidebar-link">谈谈你对CAS的理解</a></li><li><a href="/pages/util.concurrent%E7%9A%84%E7%90%86%E8%A7%A3/" class="sidebar-link">util.concurrent的理解</a></li><li><a href="/pages/%E9%AB%98%E5%B9%B6%E5%8F%91%E4%B8%8B%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%B9%82%E7%AD%89%E6%80%A7%EF%BC%9F/" class="sidebar-link">高并发下如何保证接口的幂等性？</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>MySQL</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>高阶</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>【高级】26k+档</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>大厂面试题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>求职建议</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>面经</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0d043077><div class="articleInfo" data-v-0d043077><ul class="breadcrumbs" data-v-0d043077><li data-v-0d043077><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-0d043077></a></li> <li data-v-0d043077><a href="/categories/?category=LearnJavaToFindAJob" title="分类" data-v-0d043077>LearnJavaToFindAJob</a></li><li data-v-0d043077><a href="/categories/?category=%E3%80%90%E4%B8%AD%E7%BA%A7%E3%80%9112k-26k%E6%A1%A3" title="分类" data-v-0d043077>【中级】12k-26k档</a></li><li data-v-0d043077><a href="/categories/?category=Java%E8%BF%9B%E9%98%B6" title="分类" data-v-0d043077>Java进阶</a></li></ul> <div class="info" data-v-0d043077><!----> <div title="作者" class="author iconfont icon-touxiang" data-v-0d043077><a href="/pages/%E5%85%B3%E4%BA%8E%E6%88%91/" target="_blank" title="作者" class="beLink" data-v-0d043077>程序员阿雨</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-0d043077><a href="javascript:;" data-v-0d043077>2022-06-02</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><!----> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">如何保障生产端消息投递成功？<!----></h1>  <div class="theme-vdoing-content content__default"><blockquote><p>作者：老顾聊技术
原文地址：https://www.toutiao.com/i6666219332915167756/</p></blockquote> <h1 id="目录"><a href="#目录" class="header-anchor">#</a> 目录</h1> <ol><li>前言</li> <li>分析问题</li> <li>持久化</li> <li>confirm机制</li> <li>消息提前持久化+定时任务</li></ol> <h1 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h1> <p>我们小伙伴应该都听说够消息中间件MQ，如：RabbitMQ，RocketMQ，Kafka等。引入中间件的好处可以起到抗高并发，削峰，业务解耦的作用。</p> <p><img src="https://p6-tt.byteimg.com/origin/pgc-image/1dbf5ad7aa8a4bbabc47c67a55d852fe?from=pc" alt="你知道如何保障生产端100%消息投递成功吗？"></p> <p>如上图：</p> <blockquote><p>1）订单服务投递消息给MQ中间件</p> <p>2）物流服务监听MQ中间件消息，从而进行消费</p></blockquote> <p>我们这篇文章讨论一下，如何保障订单服务把消息成功投递给MQ中间件，以RabbitMQ举例。</p> <h1 id="分析问题"><a href="#分析问题" class="header-anchor">#</a> 分析问题</h1> <p>小伙伴们对此会有些疑问，订单服务发起消息服务，返回成功不就成功了吗？如下面的伪代码</p> <p><img src="https://p1-tt.byteimg.com/origin/pgc-image/7cea5de20184420181ec8efb0df0490b?from=pc" alt="你知道如何保障生产端100%消息投递成功吗？"></p> <p>上面代码中，一般发送消息就是这么写的，小伙伴们觉得有什么问题吗？</p> <p>老顾说一个场景，如果MQ服务器突然宕机了会出现什么情况？是不是我们订单服务发过去的消息全部没有了吗？是的，**一般MQ中间件为了提高系统的吞吐量会把消息保存在内存中，如果不作其他处理，MQ服务器一旦宕机，消息将全部丢失。**这个是业务不允许的，造成很大的影响。</p> <h1 id="持久化"><a href="#持久化" class="header-anchor">#</a> 持久化</h1> <p>有经验的小伙伴会说，我知道一个方法就是把消息持久化，RabbitMQ中发消息的时候会有个durable参数可以设置，设置为true，就会持久化。</p> <p><img src="https://p1-tt.byteimg.com/origin/pgc-image/c4d839eb40d0484fa17048bfaee887f7?from=pc" alt="你知道如何保障生产端100%消息投递成功吗？"></p> <p>这样的话MQ服务器即使宕机，<strong>重启后磁盘文件中有消息的存储，这样就不会丢失了吧</strong>。是的这样就一定概率的保障了消息不丢失。</p> <p>但还会有个场景，就是<strong>消息刚刚保存到MQ内存中，但还没有来得及更新到磁盘文件中，突然宕机了</strong>。（我靠，这个时间这么短，也会出现，概率太低了吧），这个场景在持续的大量消息投递的过程中，会很常见。</p> <p>那怎么办？我们如何作才能保障一定会持久化到磁盘上面呢？</p> <h1 id="confirm机制"><a href="#confirm机制" class="header-anchor">#</a> confirm机制</h1> <p>上面问题出现在，没有人告诉我们持久化是否成功。好在很多MQ有回调通知的特性，RabbitMQ就有confirm机制来通知我们是否持久化成功？</p> <p><img src="https://p3-tt.byteimg.com/origin/pgc-image/5b6002787f1244ffac494eaaf4eaf855?from=pc" alt="你知道如何保障生产端100%消息投递成功吗？"></p> <p>confirm机制的原理：</p> <blockquote><p>1）消息生产者把消息发送给MQ，如果接收成功，MQ会返回一个ack消息给生产者</p> <p>2）如果消息接收不成功，MQ会返回一个nack消息给生产者</p></blockquote> <p><img src="https://p6-tt.byteimg.com/origin/pgc-image/a4d92db518f4499eba39a3cdb8c0643e?from=pc" alt="你知道如何保障生产端100%消息投递成功吗？"></p> <p>上面的伪代码，有两个处理消息方式，就是ack回调和nack回调。</p> <p><strong>这样是不是就可以保障100%消息不丢失了呢？</strong></p> <p>我们看一下confirm的机制，试想一下，<strong>如果我们生产者每发一条消息，都要MQ持久化到磁盘中，然后再发起ack或nack的回调。这样的话是不是我们MQ的吞吐量很不高</strong>，因为每次都要把消息持久化到磁盘中。写入磁盘这个动作是很慢的。这个在高并发场景下是不能够接受的，吞吐量太低了。</p> <p>所以<strong>MQ持久化磁盘真实的实现，是通过异步调用处理的，他是有一定的机制，如：等到有几千条消息的时候，会一次性的刷盘到磁盘上面</strong>。而<strong>不是每来一条消息，就刷盘一次</strong>。</p> <p>所以<strong>comfirm机制其实是一个异步监听的机制</strong>，是为了<strong>保证系统的高吞吐量</strong>，这样就导致了还是不能够100%保障消息不丢失，因为即使加上了confirm机制，消息在MQ内存中还没有刷盘到磁盘就宕机了，还是没法处理。</p> <p>说了这么多，还是没法确保，那怎么办呢？？？</p> <h1 id="消息提前持久化-定时任务"><a href="#消息提前持久化-定时任务" class="header-anchor">#</a> 消息提前持久化 + 定时任务</h1> <p>其实本质的原因是无法确定是否持久化？那我们是不是可以自己让消息持久化呢？答案是可以的，我们的方案再一步的演化。</p> <p><img src="https://p6-tt.byteimg.com/origin/pgc-image/769137c64d5b4bf5b00d5aec247d0cd4?from=pc" alt="你知道如何保障生产端100%消息投递成功吗？"></p> <p>上图流程：</p> <blockquote><p>1）订单服务生产者再投递消息之前，先把消息持久化到Redis或DB中，建议redis，高性能。消息的状态为发送中。</p> <p>2）confirm机制监听消息是否发送成功？如ack成功消息，删除redis中此消息。</p> <p>3）如果nack不成功的消息，这个可以根据自身的业务选择是否重发此消息。也可以删除此消息，由自己的业务决定。</p> <p>4）这边加了个定时任务，来拉取隔一定时间了，消息状态还是为发送中的，这个状态就表明，订单服务是没有收到ack成功消息。</p> <p>5）定时任务会作补偿性的投递消息。这个时候如果MQ回调ack成功接收了，再把redis中此消息删除。</p></blockquote> <p>这样的机制其实就是一个<strong>补偿机制</strong>，我不管MQ有没有真正的接收到，只要我的redis中的消息状态也是为【发送中】，就表示此消息没有正确成功投递。<strong>再启动定时任务去监控，发起补偿投递。</strong></p> <p>当然定时任务那边我们还可以<strong>加上一个补偿的次数，如果大于3次，还是没有收到ack消息，那就直接把消息的状态设置为【失败】</strong>，由人工去排查到底是为什么？</p> <p>这样的话方案就比较完美了，<strong>保障了100%的消息不丢失</strong>（当然不包含磁盘也坏了，可以做主从方案）。</p> <p>不过这样的方案，就会有<strong>可能发送多次相同的消息</strong>，很有可能MQ已经收到了消息，就是ack消息回调时出现网络故障，没有让生产者收到。那就要要求**消费者一定在消费的时候保障幂等性。**至于什么是幂等性，如何设计幂等？请看<a href="https://www.toutiao.com/i6666219332915167756/?group_id=6666219332915167756" target="_blank" rel="noopener noreferrer">海量订单产生的业务高峰期，如何避免消息的重复消费？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，谢谢大家观看。</p></div></div> <div class="read-more-wrap" style="display:none;position:absolute;bottom:0px;z-index:9999;width:100%;margin-top:-100px;font-family:PingFangSC-Regular, sans-serif;"><div id="read-more-mask" style="position: relative; height: 300px; background:-webkit-gradient(linear, 0 0%, 0 50%, from(rgba(255, 255, 255, 0)), to(rgb(255 255 255 / 82%)));"></div> <a id="read-more-btn" target="_self" style="position: absolute; left: 50%; top: 50%; bottom: 30px; transform: translate(-50%, -50%); width: 160px; height: 36px; line-height: 36px; font-size: 15px; text-align: center; border: 1px solid rgb(222, 104, 109); color: rgb(222, 104, 109); background: rgb(255, 255, 255); cursor: pointer; border-radius: 6px;"><span id="read-more-text">阅读全文</span> <br style="display:none;"> <span id="read-more-text_remainder"></span></a> <div id="btw-modal-wrap" style="display: none;"><div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0);"></div> <div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;"><span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 34px; font-size: 34px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">×</span> <p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px;">
                  （为防止恶意爬虫）
                  <br>
                  扫码或搜索：<span style="color: #E9405A; font-weight: bold;">HelloCoder</span> <br>发送：<span id="fustack-token" class="token" style="color: #e9415a; font-weight: bold; font-size: 17px; margin-bottom: 45px;">290992</span> <br>即可<span style="color: #e9415a; font-weight: bold;">永久解锁</span>本站全部文章</p> <img src="/img/site/HelloCoder.png" style="width: 180px; margin-top: 10px; margin-bottom: 30px; border: 8px solid rgb(230, 230, 230);"> <div class="input-password"><input id="input_password" autocomplete="off" placeholder="请输入密码"> <span><a id="check_password" target="_self" class="btn-password"> 解锁 </a></span></div></div></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022-07-23 15:30:20</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/%EF%BC%8810%EF%BC%89%E5%88%A9%E7%94%A8Docsify%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0%E7%BD%91%E7%AB%99/"><div>
            （10）利用Docsify搭建个人笔记网站
            <!----></div></a> <span class="date">07-14</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/%EF%BC%8812%EF%BC%89%E5%88%A9%E7%94%A8WordPress%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/"><div>
            （12）利用WordPress搭建个人网站
            <!----></div></a> <span class="date">07-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/%EF%BC%8811%EF%BC%89GitHub+Hexo%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E7%BD%91%E7%AB%99%E3%80%81%E5%8D%9A%E5%AE%A2/"><div>
            （11）GitHub+Hexo搭建自己的网站、博客
            <!----></div></a> <span class="date">07-14</span></dt></dl> <dl><dd></dd> <dt><a href="/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:huangyongwen0306@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://www.zhihu.com/people/dai-ma-coder" title="知乎" target="_blank" class="iconfont icon-zhihu"></a><a href="/img/site/HelloCoder.png" title="微信公众号" target="_blank" class="iconfont icon-weixin"></a></div> 
    Theme by
    <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
      | Copyright © 2020-2022
      <span>程序员阿雨</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.bbda35f8.js" defer></script><script src="/assets/js/3.20e33b3c.js" defer></script><script src="/assets/js/4.2d053232.js" defer></script><script src="/assets/js/65.dbed26c0.js" defer></script>
  </body>
</html>
