(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{464:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("内核态和用户态是操作系统中的两种运行模式。它们的主要区别在于权限和可执行的操作：")]),t._v(" "),s("ul",[s("li",[t._v("内核态（Kernel Mode）：在内核态下，CPU可以执行所有的指令和访问所有的硬件资源。这种模式下的操作具有更高的权限，主要用于操作系统内核的运行。\n"),s("ul",[s("li",[t._v("应用程序运行的地方，受限但安全")])])]),t._v(" "),s("li",[t._v("用户态（User Mode）：在用户态下，CPU只能执行部分指令集，无法直接访问硬件资源。这种模式下的操作权限较低，主要用于运行用户程序。\n"),s("ul",[s("li",[t._v("操作系统核心运行的地方，全权但危险")])])])]),t._v(" "),s("h3",{attrs:{id:"详细对比"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#详细对比"}},[t._v("#")]),t._v(" 详细对比")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("特性")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("用户态 (User Mode)")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("内核态 (Kernel Mode)")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("权限等级")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("低权限（Ring 3）")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("最高权限（Ring 0）")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("能访问的内存")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("只能访问用户空间内存")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("可以访问所有内存 包括内核空间")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("能执行的指令")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("普通CPU指令")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("所有CPU指令 包括特权指令")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("资源访问")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("受限的硬件访问")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("直接访问所有硬件")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("稳定性影响")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("崩溃只影响自身进程")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("崩溃导致整个系统崩溃")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("执行速度")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("快（无上下文切换）")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("慢（需要上下文切换）")])])])]),t._v(" "),s("h3",{attrs:{id:"为什么要区分两种状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么要区分两种状态"}},[t._v("#")]),t._v(" 为什么要区分两种状态？")]),t._v(" "),s("p",[t._v("1、 "),s("strong",[t._v("安全保护")]),t._v(" - 防止程序破坏系统")]),t._v(" "),s("div",{staticClass:"language-c extra-class"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用户态程序试图直接操作硬件 - 会失败")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("user_mode_try_hardware")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这些操作在用户态是禁止的：")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("disable_interrupts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ❌ 不允许")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("modify_page_tables")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ❌ 不允许  ")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("access_hardware_ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ❌ 不允许")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("通过对权限的划分，用户程序无法直接访问硬件资源，从而避免了恶意程序对系统资源的破坏。")]),t._v(" "),s("div",{staticClass:"language-c extra-class"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 想象如果允许应用程序直接调用内核指令：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("malicious_app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 黑客程序可以：")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("halt_cpu")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("              "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ❌ 停止所有CPU")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("format_disk")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ❌ 格式化硬盘")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("disable_firewall")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ❌ 关闭防火墙")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install_rootkit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ❌ 安装后门")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("steal_all_passwords")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ❌ 窃取所有密码")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 整个系统会立即崩溃或被完全控制")]),t._v("\n")])])]),s("p",[t._v("2、 "),s("strong",[t._v("稳定保障")]),t._v(" - 隔离应用程序")]),t._v(" "),s("ul",[s("li",[t._v("一个应用程序崩溃不会影响操作系统")]),t._v(" "),s("li",[t._v("恶意程序无法破坏内核")]),t._v(" "),s("li",[t._v("硬件错误被内核捕获处理")])]),t._v(" "),s("p",[t._v("3、 "),s("strong",[t._v("统一管理")]),t._v(" - 资源调度公平")]),t._v(" "),s("div",{staticClass:"language-c extra-class"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 只有内核能公平调度资源")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("kernel_schedule")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 决定哪个进程获得CPU时间片")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 管理内存分配")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 协调I/O设备访问")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("万一应用程序直接调用")])]),t._v(" "),s("p",[t._v("总结：有助于保证操作系统的安全性、稳定性和易维护性。")]),t._v(" "),s("h3",{attrs:{id:"q1-什么时候会发生用户态→内核态切换"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#q1-什么时候会发生用户态→内核态切换"}},[t._v("#")]),t._v(" Q1：什么时候会发生用户态→内核态切换？")]),t._v(" "),s("p",[s("strong",[t._v("A")]),t._v("：三种情况：")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("系统调用")]),t._v("：程序主动调用（read/write/fork等）")]),t._v(" "),s("li",[s("strong",[t._v("异常")]),t._v("：除零、页错误、非法指令等")]),t._v(" "),s("li",[s("strong",[t._v("中断")]),t._v("：硬件中断（时钟、键盘、网络包到达）")])]),t._v(" "),s("h3",{attrs:{id:"q2-为什么不能所有程序都运行在内核态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#q2-为什么不能所有程序都运行在内核态"}},[t._v("#")]),t._v(" Q2：为什么不能所有程序都运行在内核态？")]),t._v(" "),s("p",[s("strong",[t._v("A")]),t._v("：因为：")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("安全性")]),t._v("：恶意程序会破坏整个系统")]),t._v(" "),s("li",[s("strong",[t._v("稳定性")]),t._v("：一个bug导致系统崩溃")]),t._v(" "),s("li",[s("strong",[t._v("性能")]),t._v("：内核需要保护自己数据结构")])]),t._v(" "),s("h3",{attrs:{id:"q3-如何减少状态切换的开销"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#q3-如何减少状态切换的开销"}},[t._v("#")]),t._v(" Q3：如何减少状态切换的开销？")]),t._v(" "),s("p",[s("strong",[t._v("A")]),t._v("：")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("批量处理")]),t._v("：合并小操作为大操作")]),t._v(" "),s("li",[s("strong",[t._v("零拷贝")]),t._v("：sendfile、mmap等")]),t._v(" "),s("li",[s("strong",[t._v("用户态驱动")]),t._v("：DPDK、SPDK等")]),t._v(" "),s("li",[s("strong",[t._v("异步IO")]),t._v("：aio、io_uring")])]),t._v(" "),s("h3",{attrs:{id:"q4-系统调用和函数调用有什么区别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#q4-系统调用和函数调用有什么区别"}},[t._v("#")]),t._v(" Q4：系统调用和函数调用有什么区别？")]),t._v(" "),s("p",[s("strong",[t._v("A")]),t._v("：")]),t._v(" "),s("p",[t._v("c")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("// 函数调用（用户态内部）\nvoid normal_call() {\n    func();  // 只是跳转，权限不变\n}\n\n// 系统调用（用户态→内核态）\nvoid system_call() {\n    read();  // 触发特权切换，进入内核\n}\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);