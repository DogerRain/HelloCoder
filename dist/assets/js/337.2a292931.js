(window.webpackJsonp=window.webpackJsonp||[]).push([[337],{764:function(v,_,t){"use strict";t.r(_);var o=t(7),r=Object(o.a)({},(function(){var v=this,_=v._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("p",[v._v("先说结论：")]),v._v(" "),_("ul",[_("li",[v._v("在 32 位操作系统，因为进程最大只能申请 3 GB 大小的虚拟内存，所以直接申请 8G 内存，会申请失败。")]),v._v(" "),_("li",[v._v("在 64 位操作系统，因为进程最大只能申请 128 TB 大小的虚拟内存，即使物理内存只有 4GB，申请 8G 内存也是没问题，因为申请的内存是虚拟内存。")])]),v._v(" "),_("hr"),v._v(" "),_("p",[v._v("首先要知道前提条件：")]),v._v(" "),_("ul",[_("li",[v._v("操作系统是32位还是64位")]),v._v(" "),_("li",[v._v("申请后的8G内存是否真的被使用")]),v._v(" "),_("li",[v._v("操作系统是否开启了 Swap机制")])]),v._v(" "),_("blockquote",[_("p",[v._v("32位 寻址的范围是2^32也就是4G")]),v._v(" "),_("p",[v._v("64位的话则有 128T")])]),v._v(" "),_("p",[v._v("还需要明白一体下面几个概念。")]),v._v(" "),_("h2",{attrs:{id:"物理内存"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#物理内存"}},[v._v("#")]),v._v(" 物理内存")]),v._v(" "),_("p",[v._v("物理内存可以理解为电脑的内存条，是真正的内存。")]),v._v(" "),_("h2",{attrs:{id:"虚拟内存"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#虚拟内存"}},[v._v("#")]),v._v(" 虚拟内存")]),v._v(" "),_("p",[v._v("虚拟内存的出现，就是为了解决直接使用物理内存的问题。")]),v._v(" "),_("p",[v._v("虚拟内存是为了满足"),_("strong",[v._v("物理内存不足时")]),v._v("而提出的策略，他是利用磁盘空间虚拟出的逻辑内存，用作虚拟内存的磁盘空间被称为交换空间（swap space）")]),v._v(" "),_("p",[v._v("进程要访问地址空间上的某一个地址，都需要把地址翻译为实际物理内存地址，这又 涉及到内存管理单元（MMU）和地址映射。")]),v._v(" "),_("p",[v._v("程序在申请内存的时候，都是直接和 虚拟内存 打交道的。")]),v._v(" "),_("h2",{attrs:{id:"申请内存"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#申请内存"}},[v._v("#")]),v._v(" 申请内存")]),v._v(" "),_("p",[v._v("是否允许申请跟 Linux 中的 overcommit_memory 参数有关，可以使用 "),_("code",[v._v("cat /proc/sys/vm/overcommit_memory")]),v._v(" 来查看这个参数，这个参数接受三个值：")]),v._v(" "),_("ul",[_("li",[v._v("如果值为 0（默认值），代表：Heuristic overcommit handling，它允许overcommit，但过于明目张胆的 overcommit 会被拒绝，比如malloc一次性申请的内存大小就超过了系统总内存。Heuristic的意思是“试探式的”，内核利用某种算法猜测你的内存申请是否合理，大概可以理解为单次申请不能超过free memory + free swap + pagecache的大小 + SLAB中可回收的部分 ，超过了就会拒绝overcommit。")]),v._v(" "),_("li",[v._v("如果值为 1，代表：Always overcommit. 允许overcommit，对内存申请来者不拒。")]),v._v(" "),_("li",[v._v("如果值为 2，代表：Don’t overcommit. 禁止overcommit。")])]),v._v(" "),_("p",[v._v("还有一种情况")]),v._v(" "),_("p",[v._v("即使 malloc 申请的是虚拟内存，只要不去访问就不会映射到物理内存，但是申请虚拟内存的过程中，还是使用到了物理内存（比如内核保存虚拟内存的数据结构，也是占用物理内存的），如果你的主机是只有 2GB 的物理内存的话，大概率会触发 OOM。")])])}),[],!1,null,null,null);_.default=r.exports}}]);