(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{404:function(t,s,a){t.exports=a.p+"assets/img/image-20240516102152084.19e857f3.png"},405:function(t,s,a){t.exports=a.p+"assets/img/image-20240516152943309.147f9277.png"},740:function(t,s,a){"use strict";a.r(s);var e=a(7),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("官方对Python接入opentelemetry的说明：")]),t._v(" "),s("p",[t._v("https://opentelemetry.io/docs/languages/python/")]),t._v(" "),s("h2",{attrs:{id:"指标、链路接入成功"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#指标、链路接入成功"}},[t._v("#")]),t._v(" 指标、链路接入成功")]),t._v(" "),s("p",[t._v("其中指标Metrics、链路Trace 都有详细的介绍了。")]),t._v(" "),s("p",[t._v("我在本地都接入数据也都成功上报了，但是唯独没有找到关于 日志Log 的说明。")]),t._v(" "),s("p",[t._v("官方也说明了，日志目前还是 开发 中。")]),t._v(" "),s("p",[s("img",{attrs:{src:a(404),alt:""}})]),t._v(" "),s("p",[t._v("那这就尴尬，指标、链路都有数据了，没有日志可不行。")]),t._v(" "),s("h2",{attrs:{id:"日志怎么办"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#日志怎么办"}},[t._v("#")]),t._v(" 日志怎么办？")]),t._v(" "),s("p",[t._v("这里opentelemetry也提供了一种通用的解决方案，就是类似于 filebeat那种，直接扫描指定的日志路径，然后收集日志。这里可以参考我的另外一篇文章。")]),t._v(" "),s("p",[t._v("以上是一种解决方案。")]),t._v(" "),s("p",[t._v("后来我看了下"),s("a",{attrs:{href:"https://github.com/open-telemetry/opentelemetry-python",target:"_blank",rel:"noopener noreferrer"}},[t._v("opentelemetry-python"),s("OutboundLink")],1),t._v("的仓库，它的介绍是有关于 Log的试验的：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("Signal")]),t._v(" "),s("th",[t._v("Status")]),t._v(" "),s("th",[t._v("Project")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("Traces")]),t._v(" "),s("td",[t._v("Stable")]),t._v(" "),s("td",[t._v("N/A")])]),t._v(" "),s("tr",[s("td",[t._v("Metrics")]),t._v(" "),s("td",[t._v("Stable")]),t._v(" "),s("td",[t._v("N/A")])]),t._v(" "),s("tr",[s("td",[t._v("Logs")]),t._v(" "),s("td",[t._v("Experimental")]),t._v(" "),s("td",[t._v("N/A")])])])]),t._v(" "),s("p",[t._v("接着看，大家猜我发现了什么？")]),t._v(" "),s("p",[t._v("仓库的代码，它在一个"),s("a",{attrs:{href:"https://github.com/open-telemetry/opentelemetry-python/blob/main/docs/examples/logs/example.py",target:"_blank",rel:"noopener noreferrer"}},[t._v("example"),s("OutboundLink")],1),t._v("的使用例子里面，有关于log的使用demo：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(405),alt:""}})]),t._v(" "),s("p",[t._v("安装我本地试了下，竟然成功了。")]),t._v(" "),s("p",[t._v("这样日志直接以otel的协议就发送给 otel-collector 了，这种方案就更简单了。")]),t._v(" "),s("p",[t._v("整合Metrics、Trace、Log 的核心代码如下：")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# metrics")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opentelemetry "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" metrics\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opentelemetry "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" trace\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opentelemetry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exporter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("otlp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("proto"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("grpc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("metric_exporter "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" OTLPMetricExporter "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" OTLPMetricExporterGRPC\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opentelemetry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exporter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("otlp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("proto"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("grpc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("trace_exporter "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" OTLPSpanExporter "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" OTLPTraceExporterGRPC\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opentelemetry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("metrics "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" NoOpMeterProvider\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opentelemetry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sdk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("metrics "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opentelemetry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sdk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("metrics"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_internal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("aggregation "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" AggregationTemporality\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opentelemetry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sdk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("metrics"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("export "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" PeriodicExportingMetricReader\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opentelemetry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sdk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("metrics"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("view "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opentelemetry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sdk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("metrics"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("view "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" View\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opentelemetry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sdk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resources "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opentelemetry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sdk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("trace "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" TracerProvider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Tracer\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opentelemetry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sdk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("trace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("export "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" BatchSpanProcessor\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opentelemetry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("trace "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" NoOpTracerProvider\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# log")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opentelemetry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exporter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("otlp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("proto"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("grpc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_log_exporter "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" OTLPLogExporter "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" OTLPLogExporterGRPC\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opentelemetry "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" _logs\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opentelemetry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sdk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_logs "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" LoggerProvider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" LoggingHandler\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opentelemetry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sdk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_internal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("export "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" BatchLogRecordProcessor\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# begin")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#endpoint 是 OTLP exporters grpc 协议的 receivers")]),t._v("\nendpoint "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:4317"')]),t._v("\nmetrics_exporter "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" OTLPMetricExporterGRPC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("endpoint"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("endpoint"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nreader "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" PeriodicExportingMetricReader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exporter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("metrics_exporter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" export_interval_millis"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                       export_timeout_millis"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建 Prometheus 导出器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Start Prometheus client")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# start_http_server(port=8073, addr="localhost")')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# reader = PrometheusMetricReader()")]),t._v("\nconfig "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_fcop_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nmetrics_attributes "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    SERVICE_NAMESPACE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tenant_code"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    SERVICE_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app_namespace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    SERVICE_INSTANCE_ID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("application_code"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    CLUSTER_TYPE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cluster_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    REGION_CODE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("region_code"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    HOST_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Utils"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_hostname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nmetrics_attributes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("update"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CommonTag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_common_tag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nresource "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Resource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("create"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("metrics_attributes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# metrics")]),t._v("\nmeter_provider "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" MeterProvider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    resource"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("resource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" metric_readers"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("reader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" views"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        change_bucket_view\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nmetrics"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("set_meter_provider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("meter_provider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" _meter\n_meter "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" metrics"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_meter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"meter-sdk"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# trace")]),t._v("\ntrace_exporter "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" OTLPTraceExporterGRPC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("endpoint"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("endpoint"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" timeout"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                       compression"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("CompressionAlgorithm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gzip\n                                      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ntrace_processor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BatchSpanProcessor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("span_exporter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("trace_exporter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                     max_queue_size"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5120")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                     max_export_batch_size"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                     schedule_delay_millis"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                     export_timeout_millis"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntrace_provider "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" TracerProvider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resource"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("resource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntrace_provider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_span_processor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("trace_processor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntrace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("set_tracer_provider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("trace_provider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" _tracer\n_tracer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" trace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_tracer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("instrumenting_module_name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tracer-sdk"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# log")]),t._v("\nlogger_provider "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" LoggerProvider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resource"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("resource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n_logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("set_logger_provider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("logger_provider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlog_exporter "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" OTLPLogExporterGRPC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("endpoint"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("endpoint"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" timeout"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insecure"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlog_record_processor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BatchLogRecordProcessor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exporter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("log_exporter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" max_queue_size"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5120")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                               max_export_batch_size"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                               schedule_delay_millis"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                               export_timeout_millis"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlogger_provider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_log_record_processor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("log_record_processor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nhandler "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" LoggingHandler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("level"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("logging"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NOTSET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" logger_provider"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("logger_provider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Attach OTLP handler to root logger")]),t._v("\nlogging"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("getLogger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("addHandler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("关于 opentelemetry log 模块的使用，仅支持 python 的 "),s("code",[t._v("logging")]),t._v(" 日志库，像其他的日志框架和库，比如："),s("code",[t._v("loguru")]),t._v("、"),s("code",[t._v("structlog")]),t._v("、"),s("code",[t._v("logbook")]),t._v("  均不支持日志拦截上报。")])])}),[],!1,null,null,null);s.default=r.exports}}]);