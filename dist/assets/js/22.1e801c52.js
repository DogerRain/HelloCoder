(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{418:function(t,s,a){t.exports=a.p+"assets/img/image-20250819163836738-1755683512421.ac30ed58.png"},763:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"经济实用的实施建议"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#经济实用的实施建议"}},[t._v("#")]),t._v(" 经济实用的实施建议")]),t._v(" "),s("p",[t._v("对于小流量服务，可以这样低成本实施：")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("基础指标")]),t._v("：先启用Spring Boot自带的Prometheus指标(几乎零成本)")]),t._v(" "),s("li",[s("strong",[t._v("关键日志")]),t._v("：只记录ERROR级别和关键业务日志")]),t._v(" "),s("li",[s("strong",[t._v("简单告警")]),t._v("：设置1-2个核心指标告警(如服务不可用)")]),t._v(" "),s("li",[s("strong",[t._v("免费工具栈")]),t._v("：使用Prometheus+Grafana等开源方案")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(418),alt:""}})]),t._v(" "),s("p",[t._v("在我的公司，OpenTelemetry  和 Prometheus 是混合使用的：")]),t._v(" "),s("p",[t._v("在基础服务器监控上，运维团队已经很早就使用了prometheus，而且kafka、clickhouse、MySQL 等等组件都有自带或者开源的expoter（prometheus指标采集，见上图），而且还有 grafna监控大盘模板。")]),t._v(" "),s("p",[t._v("只需要几步即可接入。")]),t._v(" "),s("p",[t._v("在这个基础上，应用服务指标（请求量、响应时间、错误率）也需要尽量使用 prometheus 格式。")]),t._v(" "),s("p",[t._v("我们业务团队使用Java居多，springboot已经有相关的sdk开源使用了：")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-actuator"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("io.micrometer"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("micrometer-registry-prometheus"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("开源的SDK提供了常用的指标，如 HTTP、JVM 等等，都是自动采集的。")]),t._v(" "),s("p",[t._v("但是开源的spring-boot-starter-actuator，对我们来说 有两个缺点：")]),t._v(" "),s("ul",[s("li",[t._v("自动埋点的指标不够，如果要上报埋点，需要业务改代码埋点上报")]),t._v(" "),s("li",[t._v("只有指标")])]),t._v(" "),s("p",[t._v("所以我们就使用了javaagent的形式，拦截常用的足组件埋点  ，另外引入了 OpenTelemetry，解决 链路、日志 问题。")]),t._v(" "),s("p",[t._v("使用 OpenTelemetry   把指标转换成 prometheus 格式。以便接入 prometheus 的告警监控系统。")]),t._v(" "),s("p",[t._v("k8s可自动集成prometheus，")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("annotations")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prometheus.io/jvm")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prometheus.io/os")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prometheus.io/paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /metrics\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prometheus.io/ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8073"')]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);