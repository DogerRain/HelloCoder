(window.webpackJsonp=window.webpackJsonp||[]).push([[348],{767:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("awk 是一种处理文本文件的语言，是一个强大的文本分析工具。它可以根据分隔符将每行内容进行切片，切开的部分再进行分析处理。")]),t._v(" "),s("blockquote",[s("p",[t._v("之所以叫 awk 是因为其取了三位创始人 Alfred Aho，Peter Weinberger, 和 Brian Kernighan 的 Family Name 的首字符。")])]),t._v(" "),s("p",[t._v("awk 的功能十分强大，本文只会介绍awk日常大多数的常见的应用场景，不求面面俱到，但求实用。")]),t._v(" "),s("h2",{attrs:{id:"_1、awk语法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、awk语法"}},[t._v("#")]),t._v(" 1、awk语法")]),t._v(" "),s("p",[t._v("语法：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-F 分隔符"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'commands'")]),t._v(" input-file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("参数：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("-F\t指定输入时用到的字段分隔符\n-v\t自定义变量\n-f\t从脚本中读取awk命令\n-m\t对val值设置内在限制\n")])])]),s("p",[s("code",[t._v("[-F 分隔符]")]),t._v("是可选的，因为awk默认使用"),s("strong",[t._v("空格 制表符")]),t._v("作为缺省的字段分隔符。")]),t._v(" "),s("p",[t._v("最简单的用法：（默认使用空格分隔）")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"I am HelloCoder\'s HaC"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{ print $1 }'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出：")]),t._v("\nI\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"I am HelloCoder\'s HaC"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{ print $3,$4 }'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出：")]),t._v("\nHelloCoder"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s HaC\n\n# 打印整行 和 print $0 效果一样 print \necho \"I am HelloCoder'")]),t._v('s HaC" '),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{ print $0 }'")]),t._v("\nI am HelloCoder's HaC\n")])])]),s("blockquote",[s("p",[t._v("竖线"),s("code",[t._v("|")]),t._v(" 左右被理解为简单命令，即前一个（左边）简单命令的标准输出指向后一个（右边）标准命令的标准输入")])]),t._v(" "),s("p",[s("code",[t._v("print $1")]),t._v(" 表示打印第1列")]),t._v(" "),s("p",[s("code",[t._v("print $3,$4")]),t._v(" 表示打印第3列，第4列，用"),s("code",[t._v(",")]),t._v("隔开，默认是空格隔开。")]),t._v(" "),s("p",[s("code",[t._v("print $0")]),t._v(" 其中 "),s("code",[t._v("$0")]),t._v(" 表示输出整条语句")]),t._v(" "),s("h2",{attrs:{id:"_2、使用场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、使用场景"}},[t._v("#")]),t._v(" 2、使用场景")]),t._v(" "),s("h3",{attrs:{id:"_1、只显示-etc-passwd的账户"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、只显示-etc-passwd的账户"}},[t._v("#")]),t._v(" 1、只显示/etc/passwd的账户")]),t._v(" "),s("p",[t._v("先来看看"),s("code",[t._v("/etc/passwd")]),t._v(" 内容有什么：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat /etc/passwd")]),t._v("\nroot:x:0:0:root:/root:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\n")])])]),s("p",[t._v("第一列表示账户名，我们可以利用"),s("code",[t._v("awk -F")]),t._v(" 指定分隔符打印出来：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# awk -F : '{ print $1 }' /etc/passwd")]),t._v("\nroot\nbin\ndaemon\nadm\n")])])]),s("h3",{attrs:{id:"_2、正则-过滤账户名称"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、正则-过滤账户名称"}},[t._v("#")]),t._v(" 2、正则，过滤账户名称")]),t._v(" "),s("p",[t._v("简单的运算符：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("运算符")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("= += -= *= /= %= ^= **=")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("赋值")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("?:")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("C条件表达式")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("||")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("逻辑或")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("&&")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("逻辑与")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("~ 和 !~")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("匹配正则表达式和不匹配正则表达式")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("< <= > >= != ==")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("关系运算符")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("空格")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("连接")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("+ -")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("加，减")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("* / %")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("乘，除与求余")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("+ - !")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("一元加，减和逻辑非")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("^ ***")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("求幂")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("++ --")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("增加或减少，作为前缀或后缀")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("$")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("字段引用")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("in")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("数组成员")])])])]),t._v(" "),s("h4",{attrs:{id:"_1、-包含"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、-包含"}},[t._v("#")]),t._v(" 1、~ 包含")]),t._v(" "),s("p",[s("code",[t._v('\'$1~"r"')]),t._v(" 即第一列含有"),s("code",[t._v("r")]),t._v("的就打印整行：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第一列包含 r 的")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  awk -F : '$1~\"r\" {print $1}' /etc/passwd")]),t._v("\nroot\noperator\nsystemd-bus-proxy\nsystemd-network\nchrony\n")])])]),s("p",[t._v("也支持结尾、开头、中间任意字符的正则表达：")]),t._v(" "),s("p",[s("strong",[t._v("开头：")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# r 开头的")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# awk -F : '$1~\"^r\"{print $1}' /etc/passwd")]),t._v("\nroot\nrpc\n")])])]),s("p",[s("strong",[t._v("结尾：")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# r 结尾的")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# awk -F : '$1~\"r$\"{print $1}' /etc/passwd")]),t._v("\noperator\n")])])]),s("p",[s("strong",[t._v("包含：")])]),t._v(" "),s("p",[t._v("含有字母 r 或者 t 的  ，")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# awk -F : '$1~\"r|t\"{print $1}' /etc/passwd")]),t._v("\nroot\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("halt")]),t._v("\noperator\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ftp")]),t._v("\nsystemd-bus-proxy\nsystemd-network\npolkitd\ntss\npostfix\nchrony\nntp\ntcpdump\n")])])]),s("p",[t._v("还可以写成："),s("code",[t._v("awk -F : '$1~\"r*t\"{print $1}' /etc/passwd")])]),t._v(" "),s("h4",{attrs:{id:"_2、-等于"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、-等于"}},[t._v("#")]),t._v(" 2、== 等于")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# awk -F : '$1==\"root\"{print $1}' /etc/passwd")]),t._v("\nroot\n")])])]),s("p",[s("code",[t._v(">=")]),t._v("、"),s("code",[t._v("<=")]),t._v(" 可用于比较数字，同理。")]),t._v(" "),s("h3",{attrs:{id:"_3、拼接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、拼接"}},[t._v("#")]),t._v(" 3、拼接")]),t._v(" "),s("h4",{attrs:{id:"_1、自定义列名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、自定义列名"}},[t._v("#")]),t._v(" 1、自定义列名")]),t._v(" "),s("p",[s("code",[t._v("BEGIN")]),t._v(" 表示开头要显示的内容， "),s("code",[t._v("END")]),t._v(" 命令表示在结束需要显示的内容")]),t._v(" "),s("p",[s("code",[t._v("{print $1}")]),t._v(" 你可以理解为body ，意思为中间部分，每读取一行，执行一次 "),s("code",[t._v("body")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# awk -F \':\' \'BEGIN {print "开始"} $1~"root|mysql"{print $1} END {print "结束"}\' /etc/passwd')]),t._v("\n开始\nroot\n结束\n")])])]),s("h4",{attrs:{id:"_2、行号和列还有格式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、行号和列还有格式"}},[t._v("#")]),t._v(" 2、行号和列还有格式")]),t._v(" "),s("p",[t._v("还可以使用 "),s("code",[t._v("NR")]),t._v("、"),s("code",[t._v("NF")]),t._v(" 显示"),s("code",[t._v("行号")]),t._v("、"),s("code",[t._v("列号")]),t._v("：")]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("NR")]),t._v(" 表示当前第几行，"),s("code",[t._v("NF")]),t._v("表示当前行有几列。")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#   awk -F \':\' \'BEGIN {printf "%-10s  %-10s  %-10s\\n", "行","列","第一列"} {printf "%-10s %-10s  %-10s\\n", NR, NF,$1} END {print "结束"}\' /etc/passwd')]),t._v("\n行         列         第一列\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("         root\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("         bin\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("         daemon\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("         adm\n结束\n")])])]),s("p",[s("code",[t._v('printf "%-10s %-10s %-10s\\n"')]),t._v("  类似于c语言的格式化输出，这里表示左对齐占位10个字符的字符串。")]),t._v(" "),s("h4",{attrs:{id:"_3、指定输出分隔符"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、指定输出分隔符"}},[t._v("#")]),t._v(" 3、指定输出分隔符")]),t._v(" "),s("p",[t._v("可以使用"),s("code",[t._v("OFS")]),t._v("参数指定输出分隔符")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# awk -F ':' '{print $1,$1 }' OFS=\"--\" /etc/passwd")]),t._v("\nroot--root\nbin--bin\ndaemon--daemon\nadm--adm\n")])])]),s("h3",{attrs:{id:"_4、匹配某一行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、匹配某一行"}},[t._v("#")]),t._v(" 4、匹配某一行")]),t._v(" "),s("p",[t._v("awk 可以像 grep 一样匹配某一行，以下三种做法都可以：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# awk -F ':'  '$0~\"root\"{print $0}' /etc/passwd")]),t._v("\nroot:x:0:0:root:/root:/bin/bash\noperator:x:11:0:operator:/root:/sbin/nologin\ndockerroot:x:995:992:Docker User:/var/lib/docker:/sbin/nologin\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# awk '$0~\"root\"' /etc/passwd")]),t._v("\nroot:x:0:0:root:/root:/bin/bash\noperator:x:11:0:operator:/root:/sbin/nologin\ndockerroot:x:995:992:Docker User:/var/lib/docker:/sbin/nologin\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# awk '/root/' /etc/passwd")]),t._v("\nroot:x:0:0:root:/root:/bin/bash\noperator:x:11:0:operator:/root:/sbin/nologin\ndockerroot:x:995:992:Docker User:/var/lib/docker:/sbin/nologin\n")])])]),s("p",[s("code",[t._v("/root|HaC/")]),t._v("  表示或，可以匹配多个字符串")]),t._v(" "),s("p",[t._v("grep做法：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# grep 'root' /etc/passwd")]),t._v("\nroot:x:0:0:root:/root:/bin/bash\noperator:x:11:0:operator:/root:/sbin/nologin\ndockerroot:x:995:992:Docker User:/var/lib/docker:/sbin/nologin\n")])])]),s("p",[t._v("当然，匹配行还是使用grep方便，输出会显示颜色：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/DogerRain/image@main/img2/image-20210331172314910.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_5、支持控制流程语句"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5、支持控制流程语句"}},[t._v("#")]),t._v(" 5、支持控制流程语句")]),t._v(" "),s("p",[t._v("因为akw是一门语言，所以"),s("strong",[t._v("if while do/while for break continue")]),t._v(" 都支持：")]),t._v(" "),s("p",[t._v("输出第一个字段的第一个字符大于r的行：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# awk -F ':' '{ if ($1 > \"r\") { print $1 } else { print \"--\" } }' /etc/passwd")]),t._v("\nroot\n--\n--\n--\n--\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),t._v("\n")])])]),s("p",[t._v("可以把流程控制语句放到一个"),s("code",[t._v(".awk")]),t._v("脚本文件中，然后调用执行，如"),s("code",[t._v("test.sh")]),t._v("的内容如下")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"r"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n        print "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v("   \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n        print "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--"')]),t._v("   \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("用如下方式执行，效果一样，注意要使用"),s("code",[t._v("-f")]),t._v(" ，表示调用脚本文件")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" -F "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("':'")]),t._v(" -f test.sh /etc/passwd\n")])])]),s("h2",{attrs:{id:"_3、实战"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、实战"}},[t._v("#")]),t._v(" 3、实战")]),t._v(" "),s("h3",{attrs:{id:"_1、统计每一个linux用户的进程占用内存的大小"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、统计每一个linux用户的进程占用内存的大小"}},[t._v("#")]),t._v(" 1、统计每一个Linux用户的进程占用内存的大小")]),t._v(" "),s("p",[t._v("先用"),s("code",[t._v("ps aux")]),t._v(" 命令看一下输出的格式：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ps -aux")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("USER")]),t._v("       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("51620")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3860")]),t._v(" ?        Ss   Mar24   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(":30 /usr\nroot         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.2")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" ?        S    Mar24   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(":00 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kthreadd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nroot         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" ?        S"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("   Mar24   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(":00 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kworker/0:0H"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nmysql     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1787")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12.5")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1772728")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("486156")]),t._v(" ?      Sl   Mar24   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(":53 mysqld\n")])])]),s("p",[t._v("可以看到第1列表示用户名称，第4列 "),s("code",[t._v("%MEM")]),t._v(" 表示内存占用情况比例。")]),t._v(" "),s("p",[t._v("我们可以这样写：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" aux "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'BEGIN {printf "%-5s %-5s\\n","用户名","内存占用比例"} NR!=1 {men[$1]+=$4} END {for(i in men) printf"%-10s %-0.2f\\n",i , men[i]}\'')]),t._v("\n")])])]),s("p",[s("code",[t._v("NR!=1")]),t._v(" 表示去除第一行")]),t._v(" "),s("p",[s("code",[t._v("men[$1]+=$4")]),t._v(" 表示使用第4列进行累加，akw的数组不需要声明，索引可以是字符串或者数字。")]),t._v(" "),s("p",[t._v("awk数组语法：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("array_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("index"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("value\n")])])]),s("ul",[s("li",[t._v("array_name：数组的名称")]),t._v(" "),s("li",[t._v("index：数组索引")]),t._v(" "),s("li",[t._v("value：数组中元素所赋予的值")])]),t._v(" "),s("p",[t._v("有点像Java的HashMap。")]),t._v(" "),s("p",[t._v("结果：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#  ps aux | awk \'BEGIN {printf "%-5s %-5s\\n","用户名","内存占用比例"} NR!=1 {men[$1]+=$4} END {for(i in men) printf"%-10s %-0.2f\\n",i , men[i]}\'')]),t._v("\n用户名   内存占用比例\npolkitd    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.30")]),t._v("\ndbus       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.00")]),t._v("\nnobody     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.10")]),t._v("\nlibstor+   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.00")]),t._v("\nmysql      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12.50")]),t._v("\npostfix    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.20")]),t._v("\nntp        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.00")]),t._v("\nroot       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("37.40")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2、统计nginx的独立ip访问次数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、统计nginx的独立ip访问次数"}},[t._v("#")]),t._v(" 2、统计Nginx的独立IP访问次数")]),t._v(" "),s("p",[t._v("先找到Nginx的访问日志路径：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# find / -name 'access.log'")]),t._v("\n/usr/local/nginx/logs/access.log\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /usr/local/nginx/logs/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n")])])]),s("p",[t._v("查看格式，日志较大，可以只看第一行：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat access.log | head -1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("120.239")]),t._v(".196.104 - - "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("/Jan/2021:12:50:25 +0800"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET / HTTP/1.1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("612")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36"')]),t._v("\n")])])]),s("p",[t._v("可以看到，第一列就是访问的IP。")]),t._v(" "),s("p",[t._v("我们可以这样写：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" access.log "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{ip[$1]++} END {for(i in ip) printf\"%-10s %-10d\\n\",i , ip[i]} '")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort")]),t._v(" -k2nr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("head")]),t._v(" -5 \n")])])]),s("p",[s("code",[t._v("sort -k2nr")]),t._v("  ： k2 表示第二列，n 表示数字，r 表示降序")]),t._v(" "),s("p",[s("code",[t._v("head -5")]),t._v("  ： 只打印前5行")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat access.log | awk '{ip[$1]++} END {for(i in ip) printf\"%-10s %-10d\\n\",i , ip[i]} '  |sort -k2nr | head -5")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("112.91")]),t._v(".84.72 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("44097")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("183.27")]),t._v(".153.54 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32215")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("120.239")]),t._v(".196.5 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("28490")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("183.27")]),t._v(".154.185 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25162")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("183.27")]),t._v(".152.2 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24786")]),t._v("\n")])])]),s("p",[t._v("还可以使用uniq命令进行统计：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" access.log "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print $1}'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("uniq")]),t._v(" -c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort")]),t._v(" -nr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("head")]),t._v(" -5\n")])])]),s("p",[s("code",[t._v("uniq -c")]),t._v(" ：每列旁边显示该行重复出现的次数。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM-8-8-centos logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat access.log |awk '{print $1}'|sort|uniq -c |sort -nr |head -5")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("44097")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12.91")]),t._v(".84.72\n  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32215")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.27")]),t._v(".153.54\n  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("28490")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.239")]),t._v(".196.5\n  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25162")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.27")]),t._v(".154.185\n  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24786")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("183.27")]),t._v(".152.2\n")])])]),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("p",[t._v("akw 适合对列进行操作，而且配合其他的命令一起操作会更高效。")]),t._v(" "),s("p",[t._v("可以看到以上的文本中，akw对文本的格式有要求，以特定的分隔符隔开的文本，akw处理起来会很方便，选用grep、akw、sed 可以根据以下进行区分：")]),t._v(" "),s("ul",[s("li",[t._v("grep 更适合单纯的查找或匹配文本")]),t._v(" "),s("li",[t._v("sed 更适合编辑匹配到的文本")]),t._v(" "),s("li",[t._v("awk 更适合格式化文本，对文本进行较复杂格式处理")])])])}),[],!1,null,null,null);s.default=e.exports}}]);