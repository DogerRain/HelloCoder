(window.webpackJsonp=window.webpackJsonp||[]).push([[250],{668:function(s,a,t){"use strict";t.r(a);var n=t(7),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"类加载过程以及加载机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#类加载过程以及加载机制"}},[s._v("#")]),s._v(" 类加载过程以及加载机制")]),s._v(" "),a("h3",{attrs:{id:"类加载器的种类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#类加载器的种类"}},[s._v("#")]),s._v(" 类加载器的种类：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("启动类加载器（Bootstrap ClassLoader），是虚拟机自身的一部分，用来加载Java_HOME/lib/目录中的，或者被 -Xbootclasspath 参数所指定的路径中并且被虚拟机识别的类库；")]),s._v(" "),a("p",[s._v("其他类加载器：")])]),s._v(" "),a("li",[a("p",[s._v("扩展类加载器（Extension ClassLoader）：负责加载\\lib\\ext目录或Java. ext. dirs系统变量指定的路径中的所有类库；")])]),s._v(" "),a("li",[a("p",[s._v("应用程序类加载器（Application ClassLoader）。负责加载用户类路径（classpath）上的指定类库，我们可以直接使用这个类加载器。一般情况，如果我们没有自定义类加载器默认就是用这个加载器。")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/DogerRain/image@main/img/image-20200917103311630.png",alt:" "}})]),s._v(" "),a("p",[s._v("类加载是 JVM 运行期的核心机制之一，它将 "),a("code",[s._v(".class")]),s._v(" 文件中的二进制数据读取并转化为 JVM 可以识别的 "),a("code",[s._v("java.lang.Class")]),s._v(" 对象。整个过程可以分为三大阶段："),a("strong",[s._v("加载（Loading）")]),s._v("、"),a("strong",[s._v("链接（Linking）")]),s._v("、"),a("strong",[s._v("初始化（Initialization）")])]),s._v(" "),a("h3",{attrs:{id:"加载过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加载过程"}},[s._v("#")]),s._v(" 加载过程：")]),s._v(" "),a("p",[a("strong",[s._v("加载 -> 验证 -> 准备 -> 解析 -> 初始化 -> 使用 -> 卸载")])]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("验证 -> 准备 -> 解析")]),s._v(" 这三步合起来称为 "),a("strong",[s._v("链接")])])]),s._v(" "),a("h4",{attrs:{id:"阶段一-加载-loading"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#阶段一-加载-loading"}},[s._v("#")]),s._v(" 阶段一：加载 (Loading)")]),s._v(" "),a("p",[s._v("这是类加载的第一个阶段，负责将类的二进制数据读入内存。")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("获取二进制流")]),s._v("：通过类的全限定名，查找并读取类的二进制数据流（通常是 "),a("code",[s._v(".class")]),s._v(" 文件）。")]),s._v(" "),a("li",[a("strong",[s._v("创建数据结构")]),s._v("：在方法区（或元空间/Metaspace）内为该类创建一个运行时数据结构，存储类的元信息。")]),s._v(" "),a("li",[a("strong",[s._v("生成 Class 对象")]),s._v("：在 Java 堆中生成一个代表这个类的 "),a("code",[s._v("java.lang.Class")]),s._v(" 对象，作为程序访问方法区内该类数据的接口。")])]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("核心机制")]),s._v("：这个阶段主要由 "),a("strong",[s._v("类加载器（ClassLoader）")]),s._v(" 完成。Java 提供了双亲委派模型来组织类加载器，以保证类的唯一性和安全性。")])]),s._v(" "),a("h4",{attrs:{id:"阶段二-链接-linking"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#阶段二-链接-linking"}},[s._v("#")]),s._v(" 阶段二：链接 (Linking)")]),s._v(" "),a("p",[s._v("链接是将字节码合并到 JVM 运行时状态的过程，分为三个子步骤：")]),s._v(" "),a("h5",{attrs:{id:"_1-验证-verification"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-验证-verification"}},[s._v("#")]),s._v(" 1. 验证 (Verification)")]),s._v(" "),a("p",[s._v("确保 Class 文件的字节流中包含的信息符合 JVM 规范，并且不会危害虚拟机自身的安全。这是 JVM 保证安全性的重要步骤。")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("主要检查")]),s._v("：文件格式（魔数、版本）、元数据（继承规范）、字节码（控制流、类型安全）、符号引用等。")])]),s._v(" "),a("h5",{attrs:{id:"_2-准备-preparation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-准备-preparation"}},[s._v("#")]),s._v(" 2. 准备 (Preparation)")]),s._v(" "),a("p",[s._v("为类的 "),a("strong",[s._v("静态变量（Static Fields）")]),s._v(" 分配内存，并将其初始化为 "),a("strong",[s._v("零值（Zero Value）")]),s._v("。")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("注意区别")]),s._v("：此时只是赋予系统默认的初始值（如 "),a("code",[s._v("int")]),s._v(" 为 0，"),a("code",[s._v("boolean")]),s._v(" 为 "),a("code",[s._v("false")]),s._v("，引用为 "),a("code",[s._v("null")]),s._v("），而不是程序中定义的初始值。\n"),a("ul",[a("li",[s._v("比如 "),a("code",[s._v("public static int value = 100;")]),s._v(" 此时 "),a("code",[s._v("value")]),s._v(" 的值是 "),a("code",[s._v("0")]),s._v("。")])])])]),s._v(" "),a("h5",{attrs:{id:"_3-解析-resolution"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-解析-resolution"}},[s._v("#")]),s._v(" 3. 解析 (Resolution)")]),s._v(" "),a("p",[s._v("将常量池内的"),a("strong",[s._v("符号引用（Symbolic References）替换为 直接引用（Direct References）")]),s._v("。")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("符号引用")]),s._v("：一组描述目标的字符串（如类的全限定名、方法的名称和描述符）。")]),s._v(" "),a("li",[a("strong",[s._v("直接引用")]),s._v("：直接指向目标的指针、句柄或偏移量。")]),s._v(" "),a("li",[a("strong",[s._v("时机")]),s._v("：这个阶段不一定是必须在加载时完成，也可以在运行时首次使用某个符号引用时进行。")])]),s._v(" "),a("h4",{attrs:{id:"阶段三-初始化-initialization"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#阶段三-初始化-initialization"}},[s._v("#")]),s._v(" 阶段三：初始化 (Initialization)")]),s._v(" "),a("p",[s._v("这是类加载过程的最后一步，也是真正执行 Java 代码赋予变量初值的阶段。")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("执行 "),a("code",[s._v("<clinit>()")]),s._v(" 方法")]),s._v("：JVM 会执行类的构造器方法。这个方法是由编译器自动收集类中所有"),a("strong",[s._v("静态变量的赋值动作")]),s._v("和**静态语句块（"),a("code",[s._v("static {}")]),s._v(" 块）**中的语句合并生成的。")]),s._v(" "),a("li",[a("strong",[s._v("赋予初始值")]),s._v("：在这一步，静态变量才会被赋予程序中定义的初始值。\n"),a("ul",[a("li",[s._v("承接上面的例子，"),a("code",[s._v("public static int value = 100;")]),s._v(" 此时 "),a("code",[s._v("value")]),s._v(" 的值才变为 "),a("code",[s._v("100")]),s._v("。")])])]),s._v(" "),a("li",[a("strong",[s._v("线程安全")]),s._v("：JVM 必须保证一个类的 "),a("code",[s._v("<clinit>()")]),s._v(" 方法在多线程环境中被正确地加锁和同步，确保只被执行一次。")])]),s._v(" "),a("div",{staticClass:"language-mermaid extra-class"},[a("pre",{pre:!0,attrs:{class:"language-mermaid"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("graph")]),s._v(" TD\n    A"),a("span",{pre:!0,attrs:{class:"token text string"}},[s._v("[.class 字节码文件]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),s._v(" B"),a("span",{pre:!0,attrs:{class:"token text string"}},[s._v("[加载 Loading]")]),s._v("\n    B "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),s._v(" C"),a("span",{pre:!0,attrs:{class:"token text string"}},[s._v("[连接 Linking]")]),s._v("\n    C "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),s._v(" D"),a("span",{pre:!0,attrs:{class:"token text string"}},[s._v("[初始化 Initialization]")]),s._v("\n    D "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),s._v(" E"),a("span",{pre:!0,attrs:{class:"token text string"}},[s._v("[使用阶段]")]),s._v("\n    E "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),s._v(" F"),a("span",{pre:!0,attrs:{class:"token text string"}},[s._v("[卸载 Unloading]")]),s._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("subgraph")]),s._v(" 连接 Linking\n        C "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),s._v(" C1"),a("span",{pre:!0,attrs:{class:"token text string"}},[s._v("[验证 Verification]")]),s._v("\n        C1 "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),s._v(" C2"),a("span",{pre:!0,attrs:{class:"token text string"}},[s._v("[准备 Preparation]")]),s._v("\n        C2 "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),s._v(" C3"),a("span",{pre:!0,attrs:{class:"token text string"}},[s._v("[解析 Resolution]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n")])])]),a("h3",{attrs:{id:"类初始化触发时机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#类初始化触发时机"}},[s._v("#")]),s._v(" 类初始化触发时机")]),s._v(" "),a("p",[s._v("JVM 规范严格规定了类在以下 5 种情况下会立即进行"),a("strong",[s._v("初始化")]),s._v("（Initialization）：")]),s._v(" "),a("ol",[a("li",[s._v("遇到 "),a("code",[s._v("new")]),s._v("、"),a("code",[s._v("getstatic")]),s._v("、"),a("code",[s._v("putstatic")]),s._v(" 或 "),a("code",[s._v("invokestatic")]),s._v(" 这四条字节码指令时（对应于使用 "),a("code",[s._v("new")]),s._v(" 关键字、读取或设置类的静态字段，以及调用类的静态方法）。")]),s._v(" "),a("li",[s._v("使用 "),a("code",[s._v("java.lang.reflect")]),s._v(" 包的方法对类进行反射调用时。")]),s._v(" "),a("li",[s._v("初始化一个类时，发现其父类还没有初始化，则必须先初始化其父类。")]),s._v(" "),a("li",[s._v("当 JVM 启动时，用户需要指定一个要执行的主类（包含 "),a("code",[s._v("main()")]),s._v(" 方法的类），虚拟机会先初始化这个主类。")]),s._v(" "),a("li",[s._v("使用 JDK 7 新增的动态语言支持时，如果一个 "),a("code",[s._v("java.lang.invoke.MethodHandle")]),s._v(" 实例最后解析的结果是 "),a("code",[s._v("REF_getStatic")]),s._v("、"),a("code",[s._v("REF_putStatic")]),s._v("、"),a("code",[s._v("REF_invokeStatic")]),s._v(" 的方法句柄，并且这个方法句柄所对应的类没有进行过初始化，则需要先触发其初始化。")])]),s._v(" "),a("p",[a("strong",[s._v("初始化时机")]),s._v("（主动引用）：")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. new 创建实例（最常见）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" obj "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. 读取或设置静态字段（final常量除外）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" val "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Example")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 触发Example类初始化")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. 调用静态方法")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Example")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("staticMethod")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 4. 反射调用 Class.forName()")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("forName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.example.Test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 5. 初始化子类时，父类先初始化")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 6. JVM启动时指定的主类 比如 main()方法、 springboot 的 main 入口")]),s._v("\n")])])]),a("p",[a("strong",[s._v("不会触发初始化的情况")]),s._v("（被动引用）：")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. 通过子类引用父类的静态字段")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Parent")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Child")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Parent")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 只初始化Parent，不初始化Child")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" val "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Child")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. 通过数组定义引用类")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Example")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" array "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Example")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 不触发初始化")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. 引用类的常量（编译期放入常量池）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" CONST "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" val "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Example")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CONST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 不触发初始化")]),s._v("\n")])])]),a("h2",{attrs:{id:"class-forname-和classloader-loadclass-区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#class-forname-和classloader-loadclass-区别"}},[s._v("#")]),s._v(" "),a("code",[s._v("Class.forName()")]),s._v("和"),a("code",[s._v("ClassLoader.loadClass()")]),s._v("区别？")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Class.forName()：加载+链接+初始化（默认）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("forName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.example.Test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ClassLoader.loadClass()：只加载，不初始化")]),s._v("\nclassLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadClass")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.example.Test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("比如最常见的：")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 这行代码会：")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. 加载MySQL驱动类")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. 初始化驱动类，执行静态方法块")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. 执行DriverManager.registerDriver()注册驱动")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("forName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.mysql.cj.jdbc.Driver"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("因为MySQL驱动类的静态代码块中有：")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Driver")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NonRegisteringDriver")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("Driver")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 驱动初始化时自动注册")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DriverManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("registerDriver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SQLException")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RuntimeException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"注册驱动失败"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("而使用 "),a("code",[s._v('classLoader.loadClass("com.mysql.cj.jdbc.Driver");')]),s._v(" 则无效；（即不会初始化，不会加载静态代码块）")])])}),[],!1,null,null,null);a.default=e.exports}}]);